# ç”¨æˆ·è®¤è¯æ¨¡å—å®ç°è¯´æ˜

## âœ… å·²å®ŒæˆåŠŸèƒ½

### åç«¯å®ç° (Spring Boot)

#### 1. Redisé…ç½®å’Œå·¥å…·ç±»
- âœ… `RedisConfig.java` - Redisåºåˆ—åŒ–é…ç½®
- âœ… `RedisUtils.java` - Redisæ“ä½œå·¥å…·ç±»(String/Hash/Set/List)
- **ç‰¹æ€§**: Tokenå­˜å‚¨åœ¨Redis,æ”¯æŒæ´»åŠ¨ç»­æœŸ

#### 2. å®ä½“å’ŒDTO
- âœ… `User.java` - ç”¨æˆ·å®ä½“ç±»
- âœ… `LoginUser.java` - å®ç°Spring Securityçš„UserDetailsæ¥å£
- âœ… `LoginRequest.java` - ç™»å½•è¯·æ±‚DTO
- âœ… `LoginVO.java` - ç™»å½•å“åº”VO
- **è®¾è®¡åŸåˆ™**: æ¸…æ™°çš„æ•°æ®ä¼ è¾“å¯¹è±¡åˆ†å±‚

#### 3. Mapperå±‚
- âœ… `UserMapper.java` - ç”¨æˆ·æ•°æ®è®¿é—®æ¥å£
  - æŸ¥è¯¢ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
  - æŸ¥è¯¢ç”¨æˆ·è§’è‰²åˆ—è¡¨
  - æŸ¥è¯¢ç”¨æˆ·æƒé™åˆ—è¡¨

#### 4. Serviceå±‚
- âœ… `UserDetailsServiceImpl.java` - å®ç°Spring Securityè®¤è¯
- âœ… `AuthService.java` - è®¤è¯æœåŠ¡æ¥å£
- âœ… `AuthServiceImpl.java` - è®¤è¯æœåŠ¡å®ç°
  - âœ… ç™»å½•é€»è¾‘(ç”¨æˆ·è®¤è¯ + Tokenç”Ÿæˆ + Rediså­˜å‚¨)
  - âœ… ç™»å‡ºé€»è¾‘(æ¸…é™¤Redisä¸­çš„Token)
  - âœ… è·å–ç”¨æˆ·ä¿¡æ¯
  - âœ… åˆ·æ–°Token
  - âœ… æ›´æ–°ç”¨æˆ·ç™»å½•ä¿¡æ¯(æ—¶é—´/IP)

#### 5. Controllerå±‚
- âœ… `AuthController.java` - è®¤è¯æ§åˆ¶å™¨
  - `POST /v1/auth/login` - ç”¨æˆ·ç™»å½•
  - `POST /v1/auth/logout` - ç”¨æˆ·ç™»å‡º
  - `GET /v1/auth/user-info` - è·å–ç”¨æˆ·ä¿¡æ¯
  - `POST /v1/auth/refresh-token` - åˆ·æ–°Token

#### 6. Securityé…ç½®
- âœ… `SecurityConfig.java` - Spring Securityé…ç½®
  - å…³é—­CSRF(ä½¿ç”¨JWTä¸éœ€è¦)
  - æ— çŠ¶æ€Sessionç®¡ç†
  - é…ç½®åŒ¿åè®¿é—®æ¥å£(ç™»å½•/æ–‡æ¡£)
  - å…¶ä»–æ¥å£éœ€è¦è®¤è¯

#### 7. JWTè®¤è¯è¿‡æ»¤å™¨
- âœ… `JwtAuthenticationFilter.java` - JWTè¿‡æ»¤å™¨
  - ä»è¯·æ±‚å¤´æå–Token
  - éªŒè¯Tokenæœ‰æ•ˆæ€§
  - ä»Redisè·å–ç”¨æˆ·ä¿¡æ¯
  - è®¾ç½®SecurityContext
  - **è‡ªåŠ¨ç»­æœŸ**: æ¯æ¬¡è¯·æ±‚åˆ·æ–°Redisè¿‡æœŸæ—¶é—´

### å‰ç«¯å®ç° (Vue 3)

#### 1. APIæ¥å£
- âœ… `src/api/auth.js`
  - login() - ç™»å½•
  - logout() - ç™»å‡º
  - getUserInfo() - è·å–ç”¨æˆ·ä¿¡æ¯
  - refreshToken() - åˆ·æ–°Token

#### 2. çŠ¶æ€ç®¡ç†
- âœ… `src/store/modules/user.js` - ç”¨æˆ·çŠ¶æ€ç®¡ç†
  - Tokenç®¡ç†
  - ç”¨æˆ·ä¿¡æ¯
  - è§’è‰²å’Œæƒé™
  - ç™»å½•/ç™»å‡º/è·å–ä¿¡æ¯æ–¹æ³•

#### 3. è·¯ç”±é…ç½®
- âœ… `src/router/index.js` - è·¯ç”±æƒé™å®ˆå«
  - ç™»å½•éªŒè¯
  - è‡ªåŠ¨è·å–ç”¨æˆ·ä¿¡æ¯
  - é‡å®šå‘å¤„ç†
  - é¡µé¢æ ‡é¢˜è®¾ç½®

#### 4. å·¥å…·å‡½æ•°
- âœ… `src/utils/request.js` - Axioså°è£…
  - è‡ªåŠ¨æ·»åŠ Token
  - è¯·æ±‚/å“åº”æ‹¦æˆª
  - ç»Ÿä¸€é”™è¯¯å¤„ç†
  - Tokenè¿‡æœŸå¤„ç†

- âœ… `src/utils/auth.js` - Tokenç®¡ç†
  - getToken() - è·å–Token
  - setToken() - ä¿å­˜Token
  - removeToken() - åˆ é™¤Token

#### 5. é¡µé¢ç»„ä»¶
- âœ… `src/views/login/index.vue` - ç™»å½•é¡µé¢
  - è¡¨å•éªŒè¯
  - ç™»å½•æäº¤
  - åŠ è½½çŠ¶æ€
  - å“åº”å¼è®¾è®¡

- âœ… `src/components/Layout/index.vue` - å¸ƒå±€ç»„ä»¶
  - ä¾§è¾¹èœå•
  - é¡¶éƒ¨å¯¼èˆª
  - é¢åŒ…å±‘å¯¼èˆª
  - ç”¨æˆ·ä¸‹æ‹‰èœå•
  - å“åº”å¼å¸ƒå±€

- âœ… `src/views/home/index.vue` - é¦–é¡µ
  - ç”¨æˆ·ä¿¡æ¯å±•ç¤º
  - ç»Ÿè®¡å¡ç‰‡
  - å¿«æ·å…¥å£
  - å®æ—¶æ—¶é—´

## ğŸ¯ æ ¸å¿ƒç‰¹æ€§

### 1. Tokenå­˜å‚¨åœ¨Redis
```java
// ç™»å½•æ—¶å­˜å‚¨
String redisKey = CommonConstant.LOGIN_USER_KEY + token;
redisUtils.set(redisKey, loginUser, jwtUtils.getExpiration());

// æ¯æ¬¡è¯·æ±‚è‡ªåŠ¨ç»­æœŸ
redisUtils.expire(redisKey, jwtUtils.getExpiration());

// ç™»å‡ºæ—¶åˆ é™¤
redisUtils.del(redisKey);
```

### 2. æ´»åŠ¨ç»­æœŸæœºåˆ¶
- ç”¨æˆ·æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ·æ–°Tokenåœ¨Redisä¸­çš„è¿‡æœŸæ—¶é—´
- é¿å…ç”¨æˆ·åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­çªç„¶æ‰çº¿
- é•¿æ—¶é—´ä¸æ´»åŠ¨æ‰ä¼šçœŸæ­£è¿‡æœŸ

### 3. æƒé™æ§åˆ¶
```java
// åŸºäºè§’è‰²
@PreAuthorize("hasRole('ADMIN')")

// åŸºäºæƒé™
@PreAuthorize("hasAuthority('system:user:add')")
```

### 4. å‰åç«¯åˆ†ç¦»è®¤è¯æµç¨‹
```
1. ç”¨æˆ·ç™»å½• â†’ åç«¯éªŒè¯ â†’ ç”ŸæˆJWT Token
2. Tokenå­˜å‚¨åˆ°Redis(key=login:user:token, value=LoginUserå¯¹è±¡)
3. å‰ç«¯ä¿å­˜Tokenåˆ°Cookie
4. åç»­è¯·æ±‚æºå¸¦Token â†’ è¿‡æ»¤å™¨éªŒè¯ â†’ ä»Redisè·å–ç”¨æˆ·ä¿¡æ¯
5. è®¾ç½®SecurityContext â†’ ä¸šåŠ¡å¤„ç†
```

## ğŸ“ è®¾è®¡åŸåˆ™ä½“ç°

### SOLIDåŸåˆ™
- **å•ä¸€èŒè´£**: æ¯ä¸ªç±»åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
  - `AuthService` - è®¤è¯ä¸šåŠ¡é€»è¾‘
  - `UserDetailsServiceImpl` - ç”¨æˆ·ä¿¡æ¯åŠ è½½
  - `JwtAuthenticationFilter` - TokenéªŒè¯

- **å¼€é—­åŸåˆ™**: åŸºäºæ¥å£ç¼–ç¨‹,æ˜“äºæ‰©å±•
  - `AuthService` æ¥å£å¯æ‰©å±•æ–°çš„è®¤è¯æ–¹å¼
  - `UserDetails` æ¥å£å¯è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯

### DRYåŸåˆ™
- `RedisUtils` - å°è£…æ‰€æœ‰Redisæ“ä½œ
- `Result` - ç»Ÿä¸€å“åº”æ ¼å¼
- `GlobalExceptionHandler` - ç»Ÿä¸€å¼‚å¸¸å¤„ç†

### KISSåŸåˆ™
- ç®€æ´æ¸…æ™°çš„ä»£ç ç»“æ„
- ç›´è§‚çš„å‘½å
- æœ€å°åŒ–å¤æ‚åº¦

## ğŸš€ å¯åŠ¨æ­¥éª¤

### 1. å¯åŠ¨Redis
```bash
# Windows
redis-server.exe redis.windows.conf

# Linux/Mac
redis-server
```

### 2. åˆå§‹åŒ–æ•°æ®åº“
```sql
-- æ‰§è¡Œschema.sqlåˆ›å»ºè¡¨ç»“æ„
mysql -u root -p < database/schema.sql

-- é»˜è®¤ç®¡ç†å‘˜è´¦å·å·²åˆ›å»º
-- ç”¨æˆ·å: admin
-- å¯†ç : admin123 (BCryptåŠ å¯†åå­˜å‚¨)
```

### 3. ä¿®æ”¹é…ç½®
```yaml
# backend/src/main/resources/application-dev.yml

spring:
  datasource:
    druid:
      username: root    # ä¿®æ”¹ä¸ºä½ çš„MySQLç”¨æˆ·å
      password: root    # ä¿®æ”¹ä¸ºä½ çš„MySQLå¯†ç 

  data:
    redis:
      host: localhost   # Redisåœ°å€
      port: 6379        # Redisç«¯å£
      password:         # Rediså¯†ç (å¦‚æœæœ‰)
```

### 4. å¯åŠ¨åç«¯
```bash
cd backend
mvn spring-boot:run
```

è®¿é—®: http://localhost:8080/api/doc.html

### 5. å¯åŠ¨å‰ç«¯
```bash
cd frontend
npm install
npm run dev
```

è®¿é—®: http://localhost:5173

### 6. ç™»å½•æµ‹è¯•
- ç”¨æˆ·å: `admin`
- å¯†ç : `admin123`

## ğŸ” éªŒè¯æ–¹å¼

### 1. ç™»å½•æˆåŠŸåæ£€æŸ¥Redis
```bash
redis-cli
> keys login:user:*
> get login:user:{token}
```

åº”è¯¥èƒ½çœ‹åˆ°å­˜å‚¨çš„LoginUserå¯¹è±¡

### 2. æ£€æŸ¥Tokenè‡ªåŠ¨ç»­æœŸ
- ç™»å½•åç­‰å¾…å‡ ç§’
- åˆ·æ–°é¡µé¢æˆ–ç‚¹å‡»èœå•
- å†æ¬¡æŸ¥çœ‹Redisä¸­Tokençš„TTL
```bash
> ttl login:user:{token}
```

TTLåº”è¯¥é‡æ–°å˜ä¸º604800ç§’(7å¤©)

### 3. æ£€æŸ¥æƒé™æ§åˆ¶
- ä»¥adminç”¨æˆ·ç™»å½•,å¯è®¿é—®æ‰€æœ‰åŠŸèƒ½
- æŸ¥çœ‹æµè§ˆå™¨å¼€å‘è€…å·¥å…·Networkæ ‡ç­¾
- æ¯ä¸ªè¯·æ±‚çš„Headeréƒ½åº”åŒ…å« `Authorization: Bearer {token}`

## ğŸ“Š æ•°æ®æµç¨‹å›¾

```
ç™»å½•æµç¨‹:
ç”¨æˆ·è¾“å…¥è´¦å¯†
  â†’ å‰ç«¯éªŒè¯
    â†’ POST /v1/auth/login
      â†’ Spring Securityè®¤è¯
        â†’ æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯(å«è§’è‰²æƒé™)
          â†’ ç”ŸæˆJWT Token
            â†’ å­˜å…¥Redis(key=login:user:token, value=LoginUser)
              â†’ è¿”å›Tokenå’Œç”¨æˆ·ä¿¡æ¯
                â†’ å‰ç«¯ä¿å­˜Tokenåˆ°Cookie
                  â†’ è·³è½¬åˆ°é¦–é¡µ

è¯·æ±‚æµç¨‹:
å‰ç«¯å‘èµ·è¯·æ±‚
  â†’ è‡ªåŠ¨æ·»åŠ Authorization Header
    â†’ JwtAuthenticationFilteræ‹¦æˆª
      â†’ æå–Token
        â†’ éªŒè¯Tokenæœ‰æ•ˆæ€§
          â†’ ä»Redisè·å–LoginUser
            â†’ åˆ·æ–°Redisè¿‡æœŸæ—¶é—´(ç»­æœŸ)
              â†’ è®¾ç½®SecurityContext
                â†’ æ‰§è¡Œä¸šåŠ¡é€»è¾‘
                  â†’ è¿”å›å“åº”

ç™»å‡ºæµç¨‹:
ç‚¹å‡»ç™»å‡º
  â†’ POST /v1/auth/logout
    â†’ ä»Redisåˆ é™¤Token
      â†’ å‰ç«¯æ¸…é™¤Cookie
        â†’ è·³è½¬åˆ°ç™»å½•é¡µ
```

## ğŸ› ï¸ å¯é€‰æ‰©å±•

### 1. éªŒè¯ç åŠŸèƒ½
- é›†æˆå›¾å½¢éªŒè¯ç 
- ç™»å½•æ—¶éªŒè¯
- é˜²æ­¢æš´åŠ›ç ´è§£

### 2. è®°ä½æˆ‘åŠŸèƒ½
- å»¶é•¿Tokenæœ‰æ•ˆæœŸ
- å¤šè®¾å¤‡ç™»å½•ç®¡ç†

### 3. å•ç‚¹ç™»å½•(SSO)
- OAuth 2.0é›†æˆ
- ç¬¬ä¸‰æ–¹ç™»å½•(å¾®ä¿¡/QQ)

### 4. æ“ä½œæ—¥å¿—
- è®°å½•ç™»å½•æ—¥å¿—
- è®°å½•æ“ä½œæ—¥å¿—
- å®¡è®¡è¿½è¸ª

## ğŸ“ æ€»ç»“

ç”¨æˆ·è®¤è¯æ¨¡å—å·²å®Œæ•´å®ç°:
- âœ… åç«¯: Spring Boot + Spring Security + JWT + Redis
- âœ… å‰ç«¯: Vue 3 + Pinia + ElementPlus
- âœ… Tokenå­˜å‚¨åœ¨Redis,æ”¯æŒè‡ªåŠ¨ç»­æœŸ
- âœ… å®Œå–„çš„æƒé™æ§åˆ¶ä½“ç³»
- âœ… å“åº”å¼ç™»å½•é¡µé¢å’Œå¸ƒå±€ç»„ä»¶
- âœ… éµå¾ªSOLIDã€DRYã€KISSåŸåˆ™

**ä¸‹ä¸€æ­¥å¯ä»¥å¼€å§‹å®ç°ä¸šåŠ¡æ¨¡å—**(æ–°é—»å…¬å‘Šã€èµ„æºä¸­å¿ƒç­‰)!
