# æ•°æ®åº“å˜æ›´æ–‡æ¡£

> **é¡¹ç›®åç§°**ï¼šè™šæ‹Ÿä»¿çœŸå®è®­æ•™å­¦ç®¡ç†åŠèµ„æºå…±äº«äº‘å¹³å°
> **å˜æ›´æ—¥æœŸ**ï¼š2024-12-31
> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0

---

## ğŸ“Š å˜æ›´æ¦‚è¿°

### æœ¬æ¬¡å®ç°åŠŸèƒ½
1. **ç”¨æˆ·ä¸­å¿ƒæ¨¡å—** - ä¸ªäººä¿¡æ¯ç®¡ç†
2. **ç®¡ç†å‘˜å¹³å°æ¨¡å—** - ç”¨æˆ·ç®¡ç†ã€æ–°é—»ç®¡ç†ã€å¹³å°è®¾ç½®

### æ•°æ®åº“å˜æ›´ç±»å‹
- âœ… **æ— æ–°å¢è¡¨** - åˆ©ç”¨ç°æœ‰è¡¨ç»“æ„
- âœ… **æ— ä¿®æ”¹è¡¨ç»“æ„** - ç°æœ‰è¡¨å­—æ®µå·²æ»¡è¶³éœ€æ±‚
- âœ… **æ–°å¢Mapperæ˜ å°„** - ä»…æ–°å¢SQLæ˜ å°„æ–‡ä»¶

---

## ğŸ—„ï¸ æ¶‰åŠçš„æ•°æ®åº“è¡¨

### 1. ç”¨æˆ·å’Œæƒé™ç›¸å…³è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œæ— ä¿®æ”¹ï¼‰

#### 1.1 ç”¨æˆ·è¡¨ï¼ˆ`t_user`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å…è®¸ç©º | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | å¦ | è‡ªå¢ | ç”¨æˆ·IDï¼ˆä¸»é”®ï¼‰ |
| username | VARCHAR | 50 | å¦ | - | ç”¨æˆ·åï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰ |
| password | VARCHAR | 200 | å¦ | - | å¯†ç ï¼ˆBCryptåŠ å¯†ï¼‰ |
| real_name | VARCHAR | 50 | å¦ | - | çœŸå®å§“å |
| student_no | VARCHAR | 50 | æ˜¯ | NULL | å­¦å·ï¼ˆå­¦ç”Ÿï¼‰ |
| employee_no | VARCHAR | 50 | æ˜¯ | NULL | å·¥å·ï¼ˆæ•™å¸ˆ/ç®¡ç†å‘˜ï¼‰ |
| gender | TINYINT | - | æ˜¯ | NULL | æ€§åˆ«ï¼ˆ0-æœªçŸ¥,1-ç”·,2-å¥³ï¼‰ |
| phone | VARCHAR | 20 | æ˜¯ | NULL | æ‰‹æœºå· |
| email | VARCHAR | 100 | æ˜¯ | NULL | é‚®ç®± |
| avatar | VARCHAR | 500 | æ˜¯ | NULL | å¤´åƒURL |
| status | TINYINT | - | å¦ | 1 | çŠ¶æ€ï¼ˆ0-ç¦ç”¨,1-æ­£å¸¸ï¼‰ |
| last_login_time | DATETIME | - | æ˜¯ | NULL | æœ€åç™»å½•æ—¶é—´ |
| last_login_ip | VARCHAR | 50 | æ˜¯ | NULL | æœ€åç™»å½•IP |
| create_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| create_by | BIGINT | - | æ˜¯ | NULL | åˆ›å»ºäººID |
| update_by | BIGINT | - | æ˜¯ | NULL | æ›´æ–°äººID |
| is_deleted | TINYINT | - | å¦ | 0 | é€»è¾‘åˆ é™¤ï¼ˆ0-å¦,1-æ˜¯ï¼‰ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_username` (`username`)
- KEY `idx_student_no` (`student_no`)
- KEY `idx_employee_no` (`employee_no`)
- KEY `idx_phone` (`phone`)
- KEY `idx_create_time` (`create_time`)

**æœ¬æ¬¡ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… ç”¨æˆ·ä¸­å¿ƒï¼šæŸ¥è¯¢å’Œæ›´æ–°ä¸ªäººä¿¡æ¯
- âœ… ç®¡ç†å‘˜ï¼šCRUDç”¨æˆ·æ•°æ®
- âœ… ç™»å½•è®¤è¯ï¼šéªŒè¯ç”¨æˆ·åå¯†ç 

---

#### 1.2 è§’è‰²è¡¨ï¼ˆ`t_role`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç³»ç»Ÿè§’è‰²å®šä¹‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å…è®¸ç©º | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | å¦ | è‡ªå¢ | è§’è‰²IDï¼ˆä¸»é”®ï¼‰ |
| role_code | VARCHAR | 50 | å¦ | - | è§’è‰²ç¼–ç ï¼ˆADMIN/TEACHER/STUDENTï¼‰ |
| role_name | VARCHAR | 50 | å¦ | - | è§’è‰²åç§° |
| description | VARCHAR | 200 | æ˜¯ | NULL | è§’è‰²æè¿° |
| sort_order | INT | - | æ˜¯ | 0 | æ’åº |
| status | TINYINT | - | å¦ | 1 | çŠ¶æ€ï¼ˆ0-ç¦ç”¨,1-æ­£å¸¸ï¼‰ |
| create_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| create_by | BIGINT | - | æ˜¯ | NULL | åˆ›å»ºäººID |
| update_by | BIGINT | - | æ˜¯ | NULL | æ›´æ–°äººID |
| is_deleted | TINYINT | - | å¦ | 0 | é€»è¾‘åˆ é™¤ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_role_code` (`role_code`)

**é¢„ç½®æ•°æ®ï¼š**
```sql
(1, 'ADMIN', 'è¶…çº§ç®¡ç†å‘˜', 'ç³»ç»Ÿè¶…çº§ç®¡ç†å‘˜ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™', 1, 1, 0)
(2, 'TEACHER', 'æ•™å¸ˆ', 'æ•™å¸ˆè§’è‰²ï¼Œå¯ä»¥ç®¡ç†è¯¾ç¨‹å’Œå®éªŒ', 2, 1, 0)
(3, 'STUDENT', 'å­¦ç”Ÿ', 'å­¦ç”Ÿè§’è‰²ï¼Œå¯ä»¥å­¦ä¹ è¯¾ç¨‹å’Œå®Œæˆå®éªŒ', 3, 1, 0)
```

**æœ¬æ¬¡ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… ç®¡ç†å‘˜ï¼šæŸ¥è¯¢è§’è‰²åˆ—è¡¨ç”¨äºç”¨æˆ·è§’è‰²åˆ†é…
- âœ… æƒé™æ§åˆ¶ï¼šåˆ¤æ–­ç”¨æˆ·æ˜¯å¦ä¸ºç®¡ç†å‘˜

---

#### 1.3 æƒé™è¡¨ï¼ˆ`t_permission`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç³»ç»Ÿæƒé™å®šä¹‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å…è®¸ç©º | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | å¦ | è‡ªå¢ | æƒé™IDï¼ˆä¸»é”®ï¼‰ |
| parent_id | BIGINT | - | æ˜¯ | 0 | çˆ¶æƒé™ID |
| permission_code | VARCHAR | 100 | å¦ | - | æƒé™ç¼–ç  |
| permission_name | VARCHAR | 100 | å¦ | - | æƒé™åç§° |
| permission_type | TINYINT | - | å¦ | - | æƒé™ç±»å‹ï¼ˆ1-èœå•,2-æŒ‰é’®ï¼‰ |
| menu_path | VARCHAR | 200 | æ˜¯ | NULL | èœå•è·¯å¾„ |
| menu_icon | VARCHAR | 100 | æ˜¯ | NULL | èœå•å›¾æ ‡ |
| sort_order | INT | - | æ˜¯ | 0 | æ’åº |
| status | TINYINT | - | å¦ | 1 | çŠ¶æ€ï¼ˆ0-ç¦ç”¨,1-æ­£å¸¸ï¼‰ |
| create_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| create_by | BIGINT | - | æ˜¯ | NULL | åˆ›å»ºäººID |
| update_by | BIGINT | - | æ˜¯ | NULL | æ›´æ–°äººID |
| is_deleted | TINYINT | - | å¦ | 0 | é€»è¾‘åˆ é™¤ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_permission_code` (`permission_code`)
- KEY `idx_parent_id` (`parent_id`)

**æœ¬æ¬¡ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… æƒé™æ§åˆ¶ï¼šåç«¯APIæ¥å£æƒé™éªŒè¯

---

#### 1.4 ç”¨æˆ·-è§’è‰²å…³è”è¡¨ï¼ˆ`t_user_role`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·ä¸è§’è‰²çš„å¤šå¯¹å¤šå…³ç³»

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å…è®¸ç©º | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | å¦ | è‡ªå¢ | IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | - | å¦ | - | ç”¨æˆ·ID |
| role_id | BIGINT | - | å¦ | - | è§’è‰²ID |
| create_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| create_by | BIGINT | - | æ˜¯ | NULL | åˆ›å»ºäººID |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_user_role` (`user_id`, `role_id`)
- KEY `idx_user_id` (`user_id`)
- KEY `idx_role_id` (`role_id`)

**æœ¬æ¬¡æ–°å¢æ“ä½œï¼š**
- âœ… **æ‰¹é‡æ’å…¥**ï¼šç®¡ç†å‘˜åˆ†é…è§’è‰²æ—¶æ‰¹é‡æ’å…¥ç”¨æˆ·-è§’è‰²å…³è”
- âœ… **åˆ é™¤å…³è”**ï¼šæ›´æ–°ç”¨æˆ·è§’è‰²æ—¶å…ˆåˆ é™¤æ—§å…³è”å†æ’å…¥æ–°å…³è”

---

#### 1.5 è§’è‰²-æƒé™å…³è”è¡¨ï¼ˆ`t_role_permission`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨è§’è‰²ä¸æƒé™çš„å¤šå¯¹å¤šå…³ç³»

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å…è®¸ç©º | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | å¦ | è‡ªå¢ | IDï¼ˆä¸»é”®ï¼‰ |
| role_id | BIGINT | - | å¦ | - | è§’è‰²ID |
| permission_id | BIGINT | - | å¦ | - | æƒé™ID |
| create_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| create_by | BIGINT | - | æ˜¯ | NULL | åˆ›å»ºäººID |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_role_permission` (`role_id`, `permission_id`)
- KEY `idx_role_id` (`role_id`)
- KEY `idx_permission_id` (`permission_id`)

**æœ¬æ¬¡ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… æŸ¥è¯¢ç”¨æˆ·æƒé™åˆ—è¡¨

---

### 2. ç”¨æˆ·æ‰©å±•ä¿¡æ¯è¡¨ï¼ˆå·²å­˜åœ¨ï¼Œæœ¬æ¬¡ä½¿ç”¨ï¼‰

#### 2.1 ç”¨æˆ·èµ„æ–™è¡¨ï¼ˆ`t_user_profile`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨ç”¨æˆ·è¯¦ç»†èµ„æ–™ï¼ˆé™¢ç³»ã€ä¸“ä¸šã€ç­çº§ç­‰ï¼‰

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å…è®¸ç©º | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | å¦ | è‡ªå¢ | IDï¼ˆä¸»é”®ï¼‰ |
| user_id | BIGINT | - | å¦ | - | ç”¨æˆ·IDï¼ˆå”¯ä¸€ï¼‰ |
| department | VARCHAR | 100 | æ˜¯ | NULL | é™¢ç³»/éƒ¨é—¨ |
| major | VARCHAR | 100 | æ˜¯ | NULL | ä¸“ä¸š |
| class_name | VARCHAR | 50 | æ˜¯ | NULL | ç­çº§ |
| grade | VARCHAR | 20 | æ˜¯ | NULL | å¹´çº§ |
| birth_date | DATE | - | æ˜¯ | NULL | å‡ºç”Ÿæ—¥æœŸ |
| id_card | VARCHAR | 18 | æ˜¯ | NULL | èº«ä»½è¯å· |
| address | VARCHAR | 200 | æ˜¯ | NULL | åœ°å€ |
| introduction | TEXT | - | æ˜¯ | NULL | ä¸ªäººç®€ä»‹ |
| create_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| is_deleted | TINYINT | - | å¦ | 0 | é€»è¾‘åˆ é™¤ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- UNIQUE KEY `uk_user_id` (`user_id`)

**æœ¬æ¬¡ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… ç”¨æˆ·ä¸­å¿ƒï¼šæŸ¥è¯¢å’Œæ›´æ–°æ‰©å±•èµ„æ–™

---

### 3. æ–°é—»å…¬å‘Šè¡¨ï¼ˆå·²å­˜åœ¨ï¼Œæœ¬æ¬¡ä½¿ç”¨ï¼‰

#### 3.1 æ–°é—»è¡¨ï¼ˆ`t_news`ï¼‰

**ç”¨é€”**ï¼šå­˜å‚¨æ–°é—»èµ„è®¯

| å­—æ®µå | ç±»å‹ | é•¿åº¦ | å…è®¸ç©º | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | å¦ | è‡ªå¢ | æ–°é—»IDï¼ˆä¸»é”®ï¼‰ |
| title | VARCHAR | 200 | å¦ | - | æ–°é—»æ ‡é¢˜ |
| summary | VARCHAR | 500 | æ˜¯ | NULL | æ–°é—»æ‘˜è¦ |
| content | TEXT | - | å¦ | - | æ–°é—»å†…å®¹ |
| cover_image | VARCHAR | 500 | æ˜¯ | NULL | å°é¢å›¾ç‰‡URL |
| author | VARCHAR | 50 | æ˜¯ | NULL | ä½œè€… |
| source | VARCHAR | 100 | æ˜¯ | NULL | æ¥æº |
| category | VARCHAR | 50 | æ˜¯ | NULL | åˆ†ç±» |
| tags | VARCHAR | 200 | æ˜¯ | NULL | æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰ |
| view_count | INT | - | æ˜¯ | 0 | æµè§ˆæ¬¡æ•° |
| is_top | TINYINT | - | æ˜¯ | 0 | æ˜¯å¦ç½®é¡¶ï¼ˆ0-å¦,1-æ˜¯ï¼‰ |
| is_recommend | TINYINT | - | æ˜¯ | 0 | æ˜¯å¦æ¨èï¼ˆ0-å¦,1-æ˜¯ï¼‰ |
| publish_time | DATETIME | - | æ˜¯ | NULL | å‘å¸ƒæ—¶é—´ |
| status | TINYINT | - | å¦ | 0 | çŠ¶æ€ï¼ˆ0-è‰ç¨¿,1-å·²å‘å¸ƒ,2-å·²ä¸‹æ¶ï¼‰ |
| create_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | åˆ›å»ºæ—¶é—´ |
| update_time | DATETIME | - | å¦ | CURRENT_TIMESTAMP | æ›´æ–°æ—¶é—´ |
| create_by | BIGINT | - | æ˜¯ | NULL | åˆ›å»ºäººID |
| update_by | BIGINT | - | æ˜¯ | NULL | æ›´æ–°äººID |
| is_deleted | TINYINT | - | å¦ | 0 | é€»è¾‘åˆ é™¤ |

**ç´¢å¼•ï¼š**
- PRIMARY KEY (`id`)
- KEY `idx_category` (`category`)
- KEY `idx_status` (`status`)
- KEY `idx_publish_time` (`publish_time`)
- KEY `idx_create_time` (`create_time`)

**åˆ†ç±»æšä¸¾å€¼ï¼š**
- ç³»ç»Ÿå…¬å‘Š
- æ•™å­¦æ–°é—»
- ç§‘ç ”åŠ¨æ€
- é€šçŸ¥å…¬å‘Š
- è¡Œä¸šèµ„è®¯

**çŠ¶æ€æšä¸¾å€¼ï¼š**
- 0 - è‰ç¨¿
- 1 - å·²å‘å¸ƒ
- 2 - å·²ä¸‹æ¶

**æœ¬æ¬¡ä½¿ç”¨åœºæ™¯ï¼š**
- âœ… ç®¡ç†å‘˜ï¼šæ–°é—»ç®¡ç†ï¼ˆCRUDã€å‘å¸ƒã€æ’¤å›ã€ç½®é¡¶ï¼‰
- âœ… å‰å°ï¼šå±•ç¤ºå·²å‘å¸ƒæ–°é—»

---

## ğŸ†• æ–°å¢çš„æ•°æ®åº“æ˜ å°„æ–‡ä»¶

### 1. UserRoleMapper.xml

**æ–‡ä»¶è·¯å¾„**ï¼š`backend/src/main/resources/mapper/UserRoleMapper.xml`

**åŠŸèƒ½**ï¼šç”¨æˆ·-è§’è‰²å…³è”æ‰¹é‡æ“ä½œ

**æ–°å¢SQLè¯­å¥ï¼š**

```xml
<!-- æ‰¹é‡æ’å…¥ç”¨æˆ·è§’è‰²å…³è” -->
<insert id="insertBatch" parameterType="java.util.List">
    INSERT INTO t_user_role (user_id, role_id, create_time, create_by)
    VALUES
    <foreach collection="list" item="item" separator=",">
        (#{item.userId}, #{item.roleId}, #{item.createTime}, #{item.createBy})
    </foreach>
</insert>
```

**ä½¿ç”¨åœºæ™¯ï¼š**
- ç®¡ç†å‘˜åˆ›å»ºç”¨æˆ·æ—¶æ‰¹é‡åˆ†é…è§’è‰²
- ç®¡ç†å‘˜æ›´æ–°ç”¨æˆ·è§’è‰²æ—¶æ‰¹é‡æ’å…¥æ–°è§’è‰²

---

## ğŸ“ æ–°å¢çš„Mapperæ¥å£æ–¹æ³•

### 1. UserMapper.javaï¼ˆå·²å­˜åœ¨ï¼Œä½¿ç”¨ç°æœ‰æ–¹æ³•ï¼‰

**ç°æœ‰æ–¹æ³•ï¼š**
```java
// æŸ¥è¯¢ç”¨æˆ·è§’è‰²åˆ—è¡¨
List<String> selectRolesByUserId(Long userId);

// æŸ¥è¯¢ç”¨æˆ·æƒé™åˆ—è¡¨
List<String> selectPermissionsByUserId(Long userId);
```

---

### 2. UserRoleMapper.javaï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`backend/src/main/java/com/training/module/user/mapper/UserRoleMapper.java`

**æ–°å¢æ–¹æ³•ï¼š**
```java
// æ‰¹é‡æ’å…¥ç”¨æˆ·è§’è‰²å…³è”
int insertBatch(@Param("list") List<UserRole> list);

// åˆ é™¤ç”¨æˆ·çš„æ‰€æœ‰è§’è‰²
@Delete("DELETE FROM t_user_role WHERE user_id = #{userId}")
int deleteByUserId(@Param("userId") Long userId);

// æŸ¥è¯¢ç”¨æˆ·çš„è§’è‰²IDåˆ—è¡¨
@Select("SELECT role_id FROM t_user_role WHERE user_id = #{userId}")
List<Long> selectRoleIdsByUserId(@Param("userId") Long userId);
```

---

### 3. RoleMapper.javaï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`backend/src/main/java/com/training/module/role/mapper/RoleMapper.java`

**ç»§æ‰¿æ–¹æ³•ï¼š**
```java
extends BaseMapper<Role>  // MyBatis Plusæä¾›çš„CRUDæ–¹æ³•
```

---

### 4. UserProfileMapper.javaï¼ˆæ–°å¢ï¼‰

**æ–‡ä»¶è·¯å¾„**ï¼š`backend/src/main/java/com/training/module/user/mapper/UserProfileMapper.java`

**æ–°å¢æ–¹æ³•ï¼š**
```java
// æ ¹æ®ç”¨æˆ·IDæŸ¥è¯¢æ‰©å±•ä¿¡æ¯
@Select("SELECT * FROM t_user_profile WHERE user_id = #{userId} AND is_deleted = 0")
UserProfile selectByUserId(@Param("userId") Long userId);
```

---

## ğŸ”„ æ•°æ®åº“æ“ä½œå˜æ›´

### 1. ç”¨æˆ·ç®¡ç†ç›¸å…³æ“ä½œ

| æ“ä½œ | SQLç±»å‹ | æ¶‰åŠè¡¨ | è¯´æ˜ |
|------|---------|--------|------|
| åˆ›å»ºç”¨æˆ· | INSERT | t_user | æ’å…¥ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ |
| åˆ†é…è§’è‰² | INSERT | t_user_role | æ‰¹é‡æ’å…¥ç”¨æˆ·-è§’è‰²å…³è” |
| æ›´æ–°ç”¨æˆ· | UPDATE | t_user | æ›´æ–°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ |
| æ›´æ–°è§’è‰² | DELETE + INSERT | t_user_role | å…ˆåˆ é™¤æ—§è§’è‰²ï¼Œå†æ’å…¥æ–°è§’è‰² |
| åˆ é™¤ç”¨æˆ· | UPDATE | t_user | é€»è¾‘åˆ é™¤ï¼ˆè®¾ç½®is_deleted=1ï¼‰ |
| åˆ é™¤è§’è‰²å…³è” | DELETE | t_user_role | ç‰©ç†åˆ é™¤ç”¨æˆ·è§’è‰²å…³è” |
| é‡ç½®å¯†ç  | UPDATE | t_user | æ›´æ–°passwordå­—æ®µ |
| æŸ¥è¯¢ç”¨æˆ·åˆ—è¡¨ | SELECT | t_user + t_role | åˆ†é¡µæŸ¥è¯¢ï¼Œå…³è”æŸ¥è¯¢è§’è‰² |

---

### 2. æ–°é—»ç®¡ç†ç›¸å…³æ“ä½œ

| æ“ä½œ | SQLç±»å‹ | æ¶‰åŠè¡¨ | è¯´æ˜ |
|------|---------|--------|------|
| åˆ›å»ºæ–°é—» | INSERT | t_news | æ’å…¥æ–°é—»ï¼ˆstatus=0è‰ç¨¿æˆ–status=1å·²å‘å¸ƒï¼‰ |
| æ›´æ–°æ–°é—» | UPDATE | t_news | æ›´æ–°æ–°é—»å†…å®¹ |
| åˆ é™¤æ–°é—» | UPDATE | t_news | é€»è¾‘åˆ é™¤ï¼ˆè®¾ç½®is_deleted=1ï¼‰ |
| å‘å¸ƒæ–°é—» | UPDATE | t_news | æ›´æ–°status=1ï¼Œè®¾ç½®publish_time |
| æ’¤å›æ–°é—» | UPDATE | t_news | æ›´æ–°status=2 |
| ç½®é¡¶æ–°é—» | UPDATE | t_news | æ›´æ–°is_topå­—æ®µ |
| æ¨èæ–°é—» | UPDATE | t_news | æ›´æ–°is_recommendå­—æ®µ |
| æŸ¥è¯¢æ–°é—»åˆ—è¡¨ | SELECT | t_news | åˆ†é¡µæŸ¥è¯¢ï¼Œæ”¯æŒå¤šæ¡ä»¶ç­›é€‰ |

---

### 3. ç”¨æˆ·ä¸­å¿ƒç›¸å…³æ“ä½œ

| æ“ä½œ | SQLç±»å‹ | æ¶‰åŠè¡¨ | è¯´æ˜ |
|------|---------|--------|------|
| æŸ¥è¯¢ä¸ªäººä¿¡æ¯ | SELECT | t_user + t_role | æŸ¥è¯¢ç”¨æˆ·åŸºæœ¬ä¿¡æ¯å’Œè§’è‰² |
| æ›´æ–°ä¸ªäººä¿¡æ¯ | UPDATE | t_user | æ›´æ–°çœŸå®å§“åã€æ€§åˆ«ã€æ‰‹æœºã€é‚®ç®± |
| æŸ¥è¯¢æ‰©å±•ä¿¡æ¯ | SELECT | t_user_profile | æŸ¥è¯¢é™¢ç³»ã€ä¸“ä¸šã€ç­çº§ç­‰ |
| æ›´æ–°æ‰©å±•ä¿¡æ¯ | INSERT/UPDATE | t_user_profile | æ’å…¥æˆ–æ›´æ–°æ‰©å±•ä¿¡æ¯ |
| ä¿®æ”¹å¯†ç  | UPDATE | t_user | æ›´æ–°passwordå­—æ®µ |
| ä¸Šä¼ å¤´åƒ | UPDATE | t_user | æ›´æ–°avatarå­—æ®µ |

---

## ğŸ” æƒé™æ§åˆ¶è¯´æ˜

### Spring Securityæƒé™éªŒè¯æœºåˆ¶

**å…³é”®ä¿®æ”¹ï¼š** `LoginUser.getAuthorities()` æ–¹æ³•

**ä¿®æ”¹å‰ï¼š**
```java
// ä»…è¿”å›permissions
public Collection<? extends GrantedAuthority> getAuthorities() {
    if (permissions != null && !permissions.isEmpty()) {
        return permissions.stream()
                .map(SimpleGrantedAuthority::new)
                .collect(Collectors.toList());
    }
    return List.of();
}
```

**ä¿®æ”¹åï¼š**
```java
// åŒæ—¶è¿”å›roleså’Œpermissions
public Collection<? extends GrantedAuthority> getAuthorities() {
    Set<GrantedAuthority> authorities = new HashSet<>();

    // æ·»åŠ è§’è‰²ï¼ˆè§’è‰²ä¹Ÿä½œä¸ºæƒé™ï¼‰
    if (roles != null && !roles.isEmpty()) {
        authorities.addAll(roles.stream()
                .map(SimpleGrantedAuthority::new)
                .collect(Collectors.toSet()));
    }

    // æ·»åŠ æƒé™
    if (permissions != null && !permissions.isEmpty()) {
        authorities.addAll(permissions.stream()
                .map(SimpleGrantedAuthority::new)
                .collect(Collectors.toSet()));
    }

    return authorities;
}
```

**åŸå› ï¼š**
- åç«¯æ¥å£ä½¿ç”¨ `@PreAuthorize("hasAuthority('ADMIN')")`
- Spring Security éœ€è¦åœ¨ `getAuthorities()` è¿”å›çš„åˆ—è¡¨ä¸­æ‰¾åˆ° 'ADMIN'
- ä¿®æ”¹åè§’è‰²å’Œæƒé™éƒ½ä¼šè¢«åŒ…å«åœ¨æƒé™åˆ—è¡¨ä¸­

---

## ğŸ“Š æ•°æ®ç»Ÿè®¡

### è¡¨ç»“æ„ç»Ÿè®¡

| è¡¨ç±»å‹ | æ–°å¢è¡¨ | ä¿®æ”¹è¡¨ | ä½¿ç”¨å·²æœ‰è¡¨ |
|--------|--------|--------|-----------|
| ç”¨æˆ·æƒé™ | 0 | 0 | 5 |
| ç”¨æˆ·èµ„æ–™ | 0 | 0 | 1 |
| æ–°é—»å…¬å‘Š | 0 | 0 | 1 |
| **åˆè®¡** | **0** | **0** | **7** |

### Mapperæ–‡ä»¶ç»Ÿè®¡

| ç±»å‹ | æ•°é‡ | æ–‡ä»¶å |
|------|------|--------|
| æ–°å¢XML | 1 | UserRoleMapper.xml |
| æ–°å¢æ¥å£ | 3 | UserRoleMapper.java, RoleMapper.java, UserProfileMapper.java |
| ä½¿ç”¨å·²æœ‰ | 1 | UserMapper.java |

### SQLæ“ä½œç»Ÿè®¡

| æ“ä½œç±»å‹ | æ•°é‡ | è¯´æ˜ |
|---------|------|------|
| SELECT | 15+ | æŸ¥è¯¢ç”¨æˆ·ã€è§’è‰²ã€æƒé™ã€æ–°é—»ç­‰ |
| INSERT | 4 | åˆ›å»ºç”¨æˆ·ã€åˆ†é…è§’è‰²ã€åˆ›å»ºæ–°é—»ã€æ’å…¥æ‰©å±•ä¿¡æ¯ |
| UPDATE | 8 | æ›´æ–°ç”¨æˆ·ã€æ–°é—»ã€å¯†ç ã€å¤´åƒç­‰ |
| DELETE | 2 | åˆ é™¤ç”¨æˆ·è§’è‰²å…³è” |

---

## âœ… æ•°æ®å®Œæ•´æ€§æ£€æŸ¥

### 1. å¤–é”®çº¦æŸ

**è¯´æ˜ï¼š** é¡¹ç›®æœªä½¿ç”¨æ•°æ®åº“å¤–é”®çº¦æŸï¼Œç”±åº”ç”¨å±‚ä¿è¯æ•°æ®å®Œæ•´æ€§

**åº”ç”¨å±‚ä¿è¯ï¼š**
- âœ… åˆ é™¤ç”¨æˆ·æ—¶åŒæ­¥åˆ é™¤ `t_user_role` å…³è”æ•°æ®
- âœ… åˆ›å»ºç”¨æˆ·è§’è‰²å…³è”å‰éªŒè¯è§’è‰²IDæ˜¯å¦å­˜åœ¨
- âœ… æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯æ—¶å…³è”æŸ¥è¯¢è§’è‰²æ•°æ®

---

### 2. å”¯ä¸€çº¦æŸ

| è¡¨å | å­—æ®µ | çº¦æŸå | è¯´æ˜ |
|------|------|--------|------|
| t_user | username | uk_username | ç”¨æˆ·åå”¯ä¸€ |
| t_role | role_code | uk_role_code | è§’è‰²ç¼–ç å”¯ä¸€ |
| t_permission | permission_code | uk_permission_code | æƒé™ç¼–ç å”¯ä¸€ |
| t_user_role | user_id + role_id | uk_user_role | ç”¨æˆ·è§’è‰²ç»„åˆå”¯ä¸€ |
| t_role_permission | role_id + permission_id | uk_role_permission | è§’è‰²æƒé™ç»„åˆå”¯ä¸€ |
| t_user_profile | user_id | uk_user_id | ç”¨æˆ·æ‰©å±•ä¿¡æ¯å”¯ä¸€ |

---

### 3. ç´¢å¼•ä¼˜åŒ–

**å·²åˆ›å»ºç´¢å¼•ï¼š**
```sql
-- ç”¨æˆ·è¡¨
KEY `idx_student_no` (`student_no`)      -- å­¦å·æŸ¥è¯¢
KEY `idx_employee_no` (`employee_no`)    -- å·¥å·æŸ¥è¯¢
KEY `idx_phone` (`phone`)                -- æ‰‹æœºå·æŸ¥è¯¢
KEY `idx_create_time` (`create_time`)    -- åˆ›å»ºæ—¶é—´æ’åº

-- æ–°é—»è¡¨
KEY `idx_category` (`category`)          -- åˆ†ç±»ç­›é€‰
KEY `idx_status` (`status`)              -- çŠ¶æ€ç­›é€‰
KEY `idx_publish_time` (`publish_time`)  -- å‘å¸ƒæ—¶é—´æ’åº
KEY `idx_create_time` (`create_time`)    -- åˆ›å»ºæ—¶é—´æ’åº

-- ç”¨æˆ·è§’è‰²è¡¨
KEY `idx_user_id` (`user_id`)            -- ç”¨æˆ·è§’è‰²æŸ¥è¯¢
KEY `idx_role_id` (`role_id`)            -- è§’è‰²ç”¨æˆ·æŸ¥è¯¢

-- è§’è‰²æƒé™è¡¨
KEY `idx_role_id` (`role_id`)            -- è§’è‰²æƒé™æŸ¥è¯¢
KEY `idx_permission_id` (`permission_id`) -- æƒé™è§’è‰²æŸ¥è¯¢
```

**æŸ¥è¯¢æ€§èƒ½ä¿éšœï¼š**
- âœ… ç”¨æˆ·åˆ—è¡¨åˆ†é¡µæŸ¥è¯¢ï¼šä½¿ç”¨ `idx_create_time` ç´¢å¼•
- âœ… å…³é”®è¯æœç´¢ï¼šä½¿ç”¨ `LIKE` æŸ¥è¯¢ï¼Œå»ºè®®æ•°æ®é‡å¤§æ—¶ä½¿ç”¨å…¨æ–‡ç´¢å¼•
- âœ… è§’è‰²ç­›é€‰ï¼šå¤šè¡¨JOINæŸ¥è¯¢ï¼Œä½¿ç”¨ `idx_user_id` ç´¢å¼•
- âœ… æ–°é—»åˆ—è¡¨æŸ¥è¯¢ï¼šä½¿ç”¨ `idx_status`ã€`idx_category` å¤åˆæ¡ä»¶æŸ¥è¯¢

---

## ğŸ”§ æ•°æ®åº“é…ç½®

### è¿æ¥é…ç½®ï¼ˆapplication.ymlï¼‰

```yaml
spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/virtual_training_platform?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false
    username: root
    password: ${MYSQL_PASSWORD:root}

mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.slf4j.Slf4jImpl
  global-config:
    db-config:
      logic-delete-field: isDeleted
      logic-delete-value: 1
      logic-not-delete-value: 0
```

---

## ğŸ“‹ æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬

### æ‰§è¡Œé¡ºåº

1. **åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æ„**
   ```bash
   mysql -u root -p < schema.sql
   ```

2. **åˆå§‹åŒ–æµ‹è¯•æ•°æ®**
   ```bash
   mysql -u root -p virtual_training_platform < init_test_data.sql
   ```

3. **åˆå§‹åŒ–æ–°é—»æ•°æ®ï¼ˆå¯é€‰ï¼‰**
   ```bash
   mysql -u root -p virtual_training_platform < init_news_data.sql
   ```

---

## ğŸ¯ æ€»ç»“

### æ•°æ®åº“å˜æ›´äº®ç‚¹

1. âœ… **é›¶è¡¨ç»“æ„ä¿®æ”¹** - å……åˆ†åˆ©ç”¨ç°æœ‰è¡¨ç»“æ„ï¼Œæ— éœ€ä¿®æ”¹æ•°æ®åº“schema
2. âœ… **æœ€å°ä¾µå…¥æ€§** - ä»…æ–°å¢1ä¸ªMapper XMLæ–‡ä»¶
3. âœ… **å‘åå…¼å®¹** - æ‰€æœ‰å˜æ›´ä¸å½±å“ç°æœ‰åŠŸèƒ½
4. âœ… **æ€§èƒ½ä¼˜åŒ–** - å……åˆ†åˆ©ç”¨å·²æœ‰ç´¢å¼•ï¼ŒæŸ¥è¯¢æ€§èƒ½è‰¯å¥½
5. âœ… **æ•°æ®å®‰å…¨** - ä½¿ç”¨é€»è¾‘åˆ é™¤ï¼Œæ•°æ®å¯æ¢å¤

### åŠŸèƒ½æ”¯æŒæƒ…å†µ

| åŠŸèƒ½æ¨¡å— | æ•°æ®åº“æ”¯æŒ | è¯´æ˜ |
|---------|-----------|------|
| ç”¨æˆ·ä¸­å¿ƒ | âœ… å®Œå…¨æ”¯æŒ | ä½¿ç”¨t_userã€t_user_profileè¡¨ |
| ä¸ªäººä¿¡æ¯ç®¡ç† | âœ… å®Œå…¨æ”¯æŒ | åŸºæœ¬ä¿¡æ¯+æ‰©å±•ä¿¡æ¯ |
| ç”¨æˆ·ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰ | âœ… å®Œå…¨æ”¯æŒ | å®Œæ•´CRUD+è§’è‰²åˆ†é… |
| æ–°é—»ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰ | âœ… å®Œå…¨æ”¯æŒ | å®Œæ•´CRUD+çŠ¶æ€ç®¡ç† |
| æƒé™æ§åˆ¶ | âœ… å®Œå…¨æ”¯æŒ | RBACæƒé™æ¨¡å‹ |

---

## ğŸ“ è”ç³»ä¿¡æ¯

**æ–‡æ¡£ç»´æŠ¤äºº**ï¼šTraining Team
**æœ€åæ›´æ–°**ï¼š2024-12-31
**ç‰ˆæœ¬å·**ï¼šv1.0

---

*æœ¬æ–‡æ¡£ç”± Claude Code è‡ªåŠ¨ç”Ÿæˆ*
