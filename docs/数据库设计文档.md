# 虚拟仿真实训教学管理平台 - 数据库设计文档

> **版本:** v1.0
> **数据库:** MySQL 8.0+
> **字符集:** utf8mb4
> **排序规则:** utf8mb4_unicode_ci
> **生成时间:** 2025-12-30

---

## 📋 目录

1. [数据库概述](#数据库概述)
2. [核心设计理念](#核心设计理念)
3. [模块架构](#模块架构)
4. [详细表结构](#详细表结构)
5. [ER关系图](#er关系图)
6. [索引策略](#索引策略)
7. [测试账号](#测试账号)

---

## 📊 数据库概述

**数据库名称:** `virtual_training_platform`

这是一个完整的虚拟仿真实训教学管理及资源共享云平台数据库，支持：
- 🎓 **多角色管理** - 学生、教师、管理员
- 📚 **资源共享** - 虚拟仿真、视频、音频、文档
- 🧪 **实训管理** - 课程、任务、实验室预约
- 📢 **信息发布** - 新闻、公告、消息通知
- 📈 **监控统计** - 设备、资源、教学数据监控

---

## 🎯 核心设计理念

### 1️⃣ **统一基础字段**
所有表都继承以下标准字段（符合 DRY 原则）：

```sql
create_time    DATETIME     -- 创建时间
update_time    DATETIME     -- 更新时间
create_by      BIGINT       -- 创建人ID
update_by      BIGINT       -- 更新人ID
is_deleted     TINYINT      -- 逻辑删除:0-未删除,1-已删除
```

### 2️⃣ **逻辑删除机制**
采用软删除策略，所有数据不直接物理删除，使用 `is_deleted` 标记：
- ✅ **优势:** 数据可恢复、审计追踪
- ⚠️ **注意:** 查询时需要过滤 `is_deleted = 0`

### 3️⃣ **外键约束策略**
**当前设计不使用物理外键**，原因：
- ✅ 提高插入/更新性能
- ✅ 避免分布式场景下的跨库问题
- ⚠️ 需在应用层保证数据完整性

### 4️⃣ **索引设计原则**
- **唯一索引 (UNIQUE):** 保证业务唯一性（用户名、编码等）
- **普通索引 (KEY):** 高频查询字段（状态、时间、外键等）
- **复合索引:** 多字段联合查询优化

---

## 🏗️ 模块架构

数据库分为 **9 大功能模块**，共 **30+ 数据表**：

```
virtual_training_platform/
├── 1. 用户和权限模块 (6张表)
│   ├── t_user                用户表
│   ├── t_role                角色表
│   ├── t_permission          权限表
│   ├── t_user_role           用户-角色关联表
│   ├── t_role_permission     角色-权限关联表
│   └── t_user_profile        用户详细信息表
│
├── 2. 新闻公告模块 (2张表)
│   ├── t_news                新闻资讯表
│   └── t_notice              公告通知表
│
├── 3. 用户中心模块 (3张表)
│   ├── t_user_profile        用户详细信息表
│   ├── t_user_favorite       用户收藏表
│   └── t_user_message        用户消息表
│
├── 4. 资源中心模块 (5张表)
│   ├── t_resource            资源基础表
│   ├── t_resource_simulation 虚拟仿真资源表
│   ├── t_resource_video      视频资源表
│   ├── t_resource_audio      音频资源表
│   └── t_resource_document   文档资源表
│
├── 5. 实训中心模块 (4张表)
│   ├── t_course              课程表
│   ├── t_training_task       实训任务表
│   ├── t_training_record     实训记录表
│   └── t_user_course         用户-课程关联表
│
├── 6. 实验室模块 (4张表)
│   ├── t_laboratory          实验室表
│   ├── t_lab_reservation     实验室预约表
│   ├── t_lab_usage_record    实验室使用记录表
│   └── t_shared_lab          共享实验室表
│
├── 7. 教师功能模块 (6张表)
│   ├── t_device_monitor      设备监控表
│   ├── t_resource_monitor    资源监控表
│   ├── t_teaching_monitor    教学监控表
│   ├── t_teaching_plan       教学计划表
│   ├── t_process_result      过程结果表
│   └── t_lab_application     实验室申请表
│
├── 8. 管理员功能模块 (5张表)
│   ├── t_data_dict           数据字典表
│   ├── t_system_log          系统日志表
│   ├── t_platform_setting    平台设置表
│   ├── t_simulation_device   仿真设备表
│   └── t_teacher_info        师资信息表
│
└── 9. 共享开放模块
    └── (复用资源中心和实验室模块表)
```

---

## 📚 详细表结构

### 1️⃣ 用户和权限模块

#### 🔹 t_user (用户表)

**核心业务表**，存储所有用户基础信息。

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `id` | BIGINT | ✅ | 用户ID (主键) | 1 |
| `username` | VARCHAR(50) | ✅ | 用户名 **(唯一)** | admin |
| `password` | VARCHAR(200) | ✅ | 密码(BCrypt加密) | $2a$12$... |
| `real_name` | VARCHAR(50) | ✅ | 真实姓名 | 张三 |
| `student_no` | VARCHAR(50) | ❌ | 学号(仅学生) | 2024001 |
| `employee_no` | VARCHAR(50) | ❌ | 工号(教师/管理员) | T001 |
| `gender` | TINYINT | ❌ | 性别: 0-未知, 1-男, 2-女 | 1 |
| `phone` | VARCHAR(20) | ❌ | 手机号 | 13800138000 |
| `email` | VARCHAR(100) | ❌ | 邮箱 | user@example.com |
| `avatar` | VARCHAR(500) | ❌ | 头像URL | /uploads/avatar.jpg |
| `status` | TINYINT | ✅ | 状态: 0-禁用, 1-正常 | 1 |
| `last_login_time` | DATETIME | ❌ | 最后登录时间 | 2025-12-30 10:30:00 |
| `last_login_ip` | VARCHAR(50) | ❌ | 最后登录IP | 192.168.1.100 |

**索引设计:**
```sql
PRIMARY KEY (id)
UNIQUE KEY uk_username (username)          -- 用户名唯一
KEY idx_student_no (student_no)            -- 学号查询
KEY idx_employee_no (employee_no)          -- 工号查询
KEY idx_phone (phone)                      -- 手机号查询
KEY idx_create_time (create_time)         -- 创建时间排序
```

**业务规则:**
- 用户名全局唯一
- 密码使用 BCrypt 加密 (`$2a$12$` 前缀)
- 学生用户必填 `student_no`，教师/管理员必填 `employee_no`

---

#### 🔹 t_role (角色表)

定义系统中的三种角色。

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `id` | BIGINT | ✅ | 角色ID | 1 |
| `role_code` | VARCHAR(50) | ✅ | 角色编码 **(唯一)** | ADMIN |
| `role_name` | VARCHAR(50) | ✅ | 角色名称 | 管理员 |
| `description` | VARCHAR(200) | ❌ | 角色描述 | 系统管理员 |
| `sort_order` | INT | ❌ | 排序 | 1 |
| `status` | TINYINT | ✅ | 状态: 0-禁用, 1-正常 | 1 |

**预置角色:**
```sql
1: ADMIN    - 管理员 (所有权限)
2: TEACHER  - 教师   (教学管理权限)
3: STUDENT  - 学生   (学习相关权限)
```

---

#### 🔹 t_permission (权限表)

树形结构存储菜单和按钮权限。

| 字段名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| `id` | BIGINT | ✅ | 权限ID | 1 |
| `parent_id` | BIGINT | ❌ | 父权限ID (0为顶级) | 0 |
| `permission_code` | VARCHAR(100) | ✅ | 权限编码 **(唯一)** | system:user:view |
| `permission_name` | VARCHAR(100) | ✅ | 权限名称 | 用户查看 |
| `permission_type` | TINYINT | ✅ | 类型: 1-菜单, 2-按钮 | 1 |
| `menu_path` | VARCHAR(200) | ❌ | 菜单路径 | /system/user |
| `menu_icon` | VARCHAR(100) | ❌ | 菜单图标 | user |
| `sort_order` | INT | ❌ | 排序 | 1 |
| `status` | TINYINT | ✅ | 状态: 0-禁用, 1-正常 | 1 |

**权限编码规范:**
```
格式: 模块:功能:操作
示例:
  - system:user:view    系统-用户-查看
  - course:create       课程-创建
  - lab:manage          实验室-管理
```

---

#### 🔹 t_user_role (用户-角色关联表)

多对多关系表，一个用户可以有多个角色。

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `id` | BIGINT | ✅ | 主键 |
| `user_id` | BIGINT | ✅ | 用户ID |
| `role_id` | BIGINT | ✅ | 角色ID |

**索引:**
```sql
UNIQUE KEY uk_user_role (user_id, role_id)  -- 防止重复分配
KEY idx_user_id (user_id)
KEY idx_role_id (role_id)
```

---

#### 🔹 t_role_permission (角色-权限关联表)

多对多关系表，定义角色拥有的权限。

| 字段名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| `id` | BIGINT | ✅ | 主键 |
| `role_id` | BIGINT | ✅ | 角色ID |
| `permission_id` | BIGINT | ✅ | 权限ID |

---

#### 🔹 t_user_profile (用户详细信息表)

扩展用户基础信息，一对一关系。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 主键 | 1 |
| `user_id` | BIGINT | 用户ID **(唯一)** | 1 |
| `department` | VARCHAR(100) | 院系/部门 | 计算机学院 |
| `major` | VARCHAR(100) | 专业 | 软件工程 |
| `class_name` | VARCHAR(50) | 班级 | 软工2101 |
| `grade` | VARCHAR(20) | 年级 | 2021 |
| `birth_date` | DATE | 出生日期 | 2003-05-15 |
| `id_card` | VARCHAR(18) | 身份证号 | 110101200305151234 |
| `address` | VARCHAR(200) | 地址 | 北京市海淀区 |
| `introduction` | TEXT | 个人简介 | - |

---

### 2️⃣ 新闻公告模块

#### 🔹 t_news (新闻资讯表)

发布平台新闻和资讯。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 新闻ID | 1 |
| `title` | VARCHAR(200) | 新闻标题 | 平台正式上线通知 |
| `summary` | VARCHAR(500) | 新闻摘要 | 本平台于今日正式上线... |
| `content` | TEXT | 新闻内容(富文本) | `<p>详细内容...</p>` |
| `cover_image` | VARCHAR(500) | 封面图片URL | /uploads/news/cover.jpg |
| `author` | VARCHAR(50) | 作者 | 张三 |
| `source` | VARCHAR(100) | 来源 | 教务处 |
| `category` | VARCHAR(50) | 分类 | 系统公告 |
| `tags` | VARCHAR(200) | 标签(逗号分隔) | 上线,通知,重要 |
| `view_count` | INT | 浏览次数 | 1250 |
| `is_top` | TINYINT | 是否置顶: 0-否, 1-是 | 1 |
| `is_recommend` | TINYINT | 是否推荐: 0-否, 1-是 | 1 |
| `publish_time` | DATETIME | 发布时间 | 2025-12-30 09:00:00 |
| `status` | TINYINT | 状态: 0-草稿, 1-已发布, 2-已下架 | 1 |

**索引:**
```sql
KEY idx_category (category)
KEY idx_status (status)
KEY idx_publish_time (publish_time)
```

---

#### 🔹 t_notice (公告通知表)

系统公告和重要通知。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 公告ID | 1 |
| `title` | VARCHAR(200) | 公告标题 | 系统维护通知 |
| `content` | TEXT | 公告内容 | 系统将于本周六... |
| `notice_type` | TINYINT | 类型: 1-系统公告, 2-教学通知, 3-活动公告 | 1 |
| `level` | TINYINT | 重要级别: 1-一般, 2-重要, 3-紧急 | 2 |
| `target_role` | VARCHAR(50) | 目标角色(逗号分隔) | ALL,STUDENT,TEACHER |
| `is_top` | TINYINT | 是否置顶 | 1 |
| `publish_time` | DATETIME | 发布时间 | 2025-12-30 10:00:00 |
| `expire_time` | DATETIME | 过期时间 | 2026-01-30 23:59:59 |
| `status` | TINYINT | 状态: 0-草稿, 1-已发布, 2-已过期 | 1 |
| `view_count` | INT | 浏览次数 | 580 |

---

### 3️⃣ 用户中心模块

#### 🔹 t_user_favorite (用户收藏表)

用户收藏的资源记录。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 主键 | 1 |
| `user_id` | BIGINT | 用户ID | 3 |
| `resource_type` | VARCHAR(50) | 资源类型 | NEWS, NOTICE, COURSE, RESOURCE, LAB |
| `resource_id` | BIGINT | 资源ID | 10 |

**索引:**
```sql
UNIQUE KEY uk_user_resource (user_id, resource_type, resource_id)
```

---

#### 🔹 t_user_message (用户消息表)

系统消息和通知。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 消息ID | 1 |
| `user_id` | BIGINT | 接收用户ID | 3 |
| `sender_id` | BIGINT | 发送者ID (系统消息为NULL) | NULL |
| `message_type` | TINYINT | 类型: 1-系统, 2-课程, 3-实验, 4-审核 | 1 |
| `title` | VARCHAR(200) | 消息标题 | 您有新的作业待提交 |
| `content` | TEXT | 消息内容 | - |
| `link_url` | VARCHAR(500) | 关联链接 | /course/123/task/456 |
| `is_read` | TINYINT | 是否已读: 0-未读, 1-已读 | 0 |
| `read_time` | DATETIME | 阅读时间 | NULL |

---

### 4️⃣ 资源中心模块

#### 🔹 t_resource (资源基础表)

所有资源的基础信息表，采用 **主从表设计模式**。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 资源ID | 1 |
| `resource_name` | VARCHAR(200) | 资源名称 | 化学实验虚拟仿真系统 |
| `resource_type` | VARCHAR(50) | 资源类型 | SIMULATION, VIDEO, AUDIO, DOCUMENT |
| `description` | TEXT | 资源描述 | - |
| `cover_image` | VARCHAR(500) | 封面图片 | /uploads/cover.jpg |
| `category` | VARCHAR(50) | 分类 | 化学实验 |
| `tags` | VARCHAR(200) | 标签(逗号分隔) | 虚拟仿真,化学,实验 |
| `uploader_id` | BIGINT | 上传者ID | 2 |
| `file_size` | BIGINT | 文件大小(字节) | 1048576000 |
| `download_count` | INT | 下载次数 | 158 |
| `view_count` | INT | 浏览次数 | 1250 |
| `is_shared` | TINYINT | 是否共享: 0-否, 1-是 | 1 |
| `status` | TINYINT | 状态: 0-待审核, 1-已发布, 2-已下架 | 1 |

**资源类型详细表设计 (一对一关系):**

| 资源类型 | 详细表 | 存储内容 |
|---------|--------|---------|
| SIMULATION | `t_resource_simulation` | 仿真URL、技术栈、平台要求 |
| VIDEO | `t_resource_video` | 视频URL、时长、分辨率、字幕 |
| AUDIO | `t_resource_audio` | 音频URL、时长、格式、比特率 |
| DOCUMENT | `t_resource_document` | 文档URL、格式、页数、预览URL |

---

#### 🔹 t_resource_simulation (虚拟仿真资源表)

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 主键 | 1 |
| `resource_id` | BIGINT | 资源ID **(唯一)** | 1 |
| `simulation_url` | VARCHAR(500) | 仿真URL/启动地址 | http://sim.example.com/chem-lab |
| `technology` | VARCHAR(100) | 技术栈 | Unity3D, WebGL |
| `support_platform` | VARCHAR(100) | 支持平台 | PC, Mobile, Web |
| `min_requirement` | VARCHAR(500) | 最低配置要求 | CPU: i5, RAM: 8GB, GPU: GTX1050 |

---

### 5️⃣ 实训中心模块

#### 🔹 t_course (课程表)

教师创建的课程信息。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 课程ID | 1 |
| `course_code` | VARCHAR(50) | 课程编码 **(唯一)** | CS101 |
| `course_name` | VARCHAR(200) | 课程名称 | 计算机基础 |
| `description` | TEXT | 课程描述 | - |
| `cover_image` | VARCHAR(500) | 课程封面 | /uploads/course/cover.jpg |
| `teacher_id` | BIGINT | 授课教师ID | 2 |
| `department` | VARCHAR(100) | 开课院系 | 计算机学院 |
| `credit` | DECIMAL(3,1) | 学分 | 3.0 |
| `total_hours` | INT | 总学时 | 48 |
| `category` | VARCHAR(50) | 课程类别 | 专业必修 |
| `difficulty` | TINYINT | 难度: 1-初级, 2-中级, 3-高级 | 1 |
| `start_time` | DATETIME | 开课时间 | 2025-09-01 08:00:00 |
| `end_time` | DATETIME | 结课时间 | 2026-01-10 18:00:00 |
| `max_students` | INT | 最大学生数 | 60 |
| `enrolled_count` | INT | 已报名人数 | 45 |
| `status` | TINYINT | 状态: 0-未开课, 1-进行中, 2-已结课 | 1 |

---

#### 🔹 t_training_task (实训任务表)

课程下的实训任务。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 任务ID | 1 |
| `course_id` | BIGINT | 课程ID | 1 |
| `task_name` | VARCHAR(200) | 任务名称 | 数据库设计作业 |
| `description` | TEXT | 任务描述 | - |
| `task_type` | TINYINT | 类型: 1-理论, 2-实践, 3-综合 | 2 |
| `resource_id` | BIGINT | 关联资源ID | 10 |
| `lab_id` | BIGINT | 关联实验室ID | 5 |
| `difficulty` | TINYINT | 难度 | 2 |
| `total_score` | INT | 总分 | 100 |
| `pass_score` | INT | 及格分 | 60 |
| `time_limit` | INT | 时间限制(分钟) | 120 |
| `start_time` | DATETIME | 开始时间 | 2025-12-01 08:00:00 |
| `end_time` | DATETIME | 结束时间 | 2025-12-31 23:59:59 |
| `attachment_url` | VARCHAR(500) | 附件URL | /uploads/task/task1.pdf |
| `status` | TINYINT | 状态: 0-未发布, 1-进行中, 2-已结束 | 1 |

---

#### 🔹 t_training_record (实训记录表)

学生完成任务的记录。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 记录ID | 1 |
| `task_id` | BIGINT | 任务ID | 1 |
| `user_id` | BIGINT | 学生ID | 3 |
| `start_time` | DATETIME | 开始时间 | 2025-12-10 09:00:00 |
| `end_time` | DATETIME | 结束时间 | 2025-12-10 11:30:00 |
| `duration` | INT | 用时(分钟) | 150 |
| `score` | DECIMAL(5,2) | 得分 | 85.50 |
| `submit_content` | TEXT | 提交内容 | - |
| `submit_attachment` | VARCHAR(500) | 提交附件URL | /uploads/submit/report.pdf |
| `teacher_comment` | TEXT | 教师评语 | 完成质量良好 |
| `status` | TINYINT | 状态: 0-进行中, 1-已提交, 2-已评分 | 2 |

---

#### 🔹 t_user_course (用户-课程关联表)

学生选课记录。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 主键 | 1 |
| `user_id` | BIGINT | 用户ID | 3 |
| `course_id` | BIGINT | 课程ID | 1 |
| `enroll_time` | DATETIME | 报名时间 | 2025-09-01 10:00:00 |
| `progress` | INT | 学习进度(%) | 75 |
| `total_score` | DECIMAL(5,2) | 总成绩 | 88.50 |
| `status` | TINYINT | 状态: 1-学习中, 2-已完成, 3-已退出 | 1 |

---

### 6️⃣ 实验室模块

#### 🔹 t_laboratory (实验室表)

实验室基础信息。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 实验室ID | 1 |
| `lab_code` | VARCHAR(50) | 实验室编码 **(唯一)** | LAB-001 |
| `lab_name` | VARCHAR(200) | 实验室名称 | 化学实验室A |
| `description` | TEXT | 实验室描述 | - |
| `location` | VARCHAR(200) | 所在位置 | 实验楼3层 |
| `building` | VARCHAR(100) | 所在楼栋 | 实验楼A座 |
| `room_number` | VARCHAR(50) | 房间号 | 301 |
| `capacity` | INT | 容纳人数 | 40 |
| `area` | DECIMAL(10,2) | 面积(平方米) | 120.50 |
| `manager_id` | BIGINT | 管理员ID | 2 |
| `equipment_list` | TEXT | 设备清单(JSON) | `{"devices": [...]}` |
| `open_time` | VARCHAR(200) | 开放时间 | 周一至周五 8:00-18:00 |
| `status` | TINYINT | 状态: 0-停用, 1-正常, 2-维护中 | 1 |

---

#### 🔹 t_lab_reservation (实验室预约表)

学生或教师预约实验室。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 预约ID | 1 |
| `lab_id` | BIGINT | 实验室ID | 1 |
| `user_id` | BIGINT | 预约用户ID | 3 |
| `reservation_date` | DATE | 预约日期 | 2025-12-31 |
| `start_time` | TIME | 开始时间 | 09:00:00 |
| `end_time` | TIME | 结束时间 | 11:00:00 |
| `purpose` | VARCHAR(500) | 使用目的 | 完成化学实验作业 |
| `people_count` | INT | 使用人数 | 1 |
| `contact_phone` | VARCHAR(20) | 联系电话 | 13800138002 |
| `status` | TINYINT | 状态: 0-待审核, 1-已批准, 2-已拒绝, 3-已取消, 4-已完成 | 1 |
| `approve_by` | BIGINT | 审批人ID | 2 |
| `approve_time` | DATETIME | 审批时间 | 2025-12-30 15:00:00 |
| `approve_comment` | VARCHAR(500) | 审批意见 | 批准使用 |
| `check_in_time` | DATETIME | 签到时间 | NULL |
| `check_out_time` | DATETIME | 签退时间 | NULL |

**预约流程:**
```
待审核 → 已批准/已拒绝 → 签到 → 签退 → 已完成
         ↓
      已取消
```

---

#### 🔹 t_lab_usage_record (实验室使用记录表)

实验室实际使用记录。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `id` | BIGINT | 记录ID |
| `lab_id` | BIGINT | 实验室ID |
| `reservation_id` | BIGINT | 预约ID |
| `user_id` | BIGINT | 使用用户ID |
| `use_date` | DATE | 使用日期 |
| `start_time` | DATETIME | 开始时间 |
| `end_time` | DATETIME | 结束时间 |
| `duration` | INT | 使用时长(分钟) |
| `purpose` | VARCHAR(500) | 使用目的 |
| `feedback` | TEXT | 使用反馈 |
| `equipment_status` | VARCHAR(500) | 设备状态记录 |

---

#### 🔹 t_shared_lab (共享实验室表)

标记对外开放的实验室。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 主键 | 1 |
| `lab_id` | BIGINT | 实验室ID **(唯一)** | 1 |
| `share_type` | TINYINT | 类型: 1-校内, 2-校际, 3-社会开放 | 1 |
| `share_start_time` | DATETIME | 共享开始时间 | 2025-09-01 00:00:00 |
| `share_end_time` | DATETIME | 共享结束时间 | 2026-07-01 00:00:00 |
| `open_days` | VARCHAR(100) | 开放日期(1-7,逗号分隔) | 1,2,3,4,5 |
| `open_time_slots` | VARCHAR(500) | 开放时段(JSON) | `[{"start":"09:00","end":"12:00"}]` |
| `max_appointments` | INT | 最大预约数/天 | 10 |
| `is_need_approve` | TINYINT | 是否需要审批 | 1 |
| `description` | TEXT | 共享说明 | - |
| `status` | TINYINT | 状态: 0-停止, 1-正常 | 1 |

---

### 7️⃣ 教师功能模块

#### 🔹 t_device_monitor (设备监控表)

实验室设备状态监控。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `id` | BIGINT | 监控ID |
| `lab_id` | BIGINT | 实验室ID |
| `device_name` | VARCHAR(200) | 设备名称 |
| `device_code` | VARCHAR(100) | 设备编码 |
| `device_status` | TINYINT | 状态: 0-离线, 1-正常, 2-异常, 3-维护中 |
| `cpu_usage` | DECIMAL(5,2) | CPU使用率(%) |
| `memory_usage` | DECIMAL(5,2) | 内存使用率(%) |
| `disk_usage` | DECIMAL(5,2) | 磁盘使用率(%) |
| `network_status` | TINYINT | 网络状态: 0-断开, 1-正常 |
| `last_check_time` | DATETIME | 最后检查时间 |
| `error_message` | TEXT | 错误信息 |

---

#### 🔹 t_teaching_plan (教学计划表)

教师制定的教学计划。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `id` | BIGINT | 计划ID |
| `course_id` | BIGINT | 课程ID |
| `teacher_id` | BIGINT | 教师ID |
| `plan_name` | VARCHAR(200) | 计划名称 |
| `semester` | VARCHAR(50) | 学期 |
| `week_number` | INT | 周次 |
| `content` | TEXT | 教学内容 |
| `objective` | TEXT | 教学目标 |
| `method` | VARCHAR(500) | 教学方法 |
| `resource_ids` | VARCHAR(500) | 关联资源ID(逗号分隔) |
| `homework` | TEXT | 作业安排 |
| `status` | TINYINT | 状态: 0-计划中, 1-进行中, 2-已完成 |

---

#### 🔹 t_process_result (过程结果表)

学生实训过程数据记录。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `id` | BIGINT | 结果ID |
| `task_id` | BIGINT | 任务ID |
| `user_id` | BIGINT | 学生ID |
| `process_data` | TEXT | 过程数据(JSON) |
| `step_records` | TEXT | 步骤记录 |
| `answer_records` | TEXT | 答题记录 |
| `operation_logs` | TEXT | 操作日志 |
| `score_details` | TEXT | 评分明细(JSON) |

**索引:**
```sql
UNIQUE KEY uk_task_user (task_id, user_id)
```

---

### 8️⃣ 管理员功能模块

#### 🔹 t_data_dict (数据字典表)

系统数据字典配置。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 字典ID | 1 |
| `dict_type` | VARCHAR(100) | 字典类型 | user_gender |
| `dict_code` | VARCHAR(100) | 字典编码 | MALE |
| `dict_label` | VARCHAR(200) | 字典标签 | 男 |
| `dict_value` | VARCHAR(200) | 字典值 | 1 |
| `sort_order` | INT | 排序 | 1 |
| `remark` | VARCHAR(500) | 备注 | - |
| `status` | TINYINT | 状态 | 1 |

**预置字典:**
```sql
user_gender:  UNKNOWN(未知), MALE(男), FEMALE(女)
user_status:  DISABLED(禁用), NORMAL(正常)
resource_type: SIMULATION(虚拟仿真), VIDEO(视频), AUDIO(音频), DOCUMENT(文档)
```

---

#### 🔹 t_system_log (系统日志表)

系统操作日志记录。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `id` | BIGINT | 日志ID |
| `log_type` | TINYINT | 类型: 1-登录, 2-操作, 3-异常 |
| `user_id` | BIGINT | 用户ID |
| `username` | VARCHAR(50) | 用户名 |
| `operation` | VARCHAR(200) | 操作内容 |
| `method` | VARCHAR(200) | 请求方法 |
| `params` | TEXT | 请求参数 |
| `ip_address` | VARCHAR(50) | IP地址 |
| `location` | VARCHAR(100) | IP归属地 |
| `browser` | VARCHAR(100) | 浏览器 |
| `os` | VARCHAR(100) | 操作系统 |
| `status` | TINYINT | 状态: 0-失败, 1-成功 |
| `error_message` | TEXT | 错误信息 |
| `execute_time` | INT | 执行时长(毫秒) |

---

#### 🔹 t_platform_setting (平台设置表)

系统配置项。

| 字段名 | 类型 | 说明 | 示例 |
|--------|------|------|------|
| `id` | BIGINT | 设置ID | 1 |
| `setting_key` | VARCHAR(100) | 设置键 **(唯一)** | system.title |
| `setting_value` | TEXT | 设置值 | 虚拟仿真实训平台 |
| `setting_type` | VARCHAR(50) | 类型 | STRING, NUMBER, BOOLEAN, JSON |
| `description` | VARCHAR(500) | 设置描述 | 系统标题 |
| `group_name` | VARCHAR(50) | 分组名称 | 基础设置 |

---

#### 🔹 t_simulation_device (仿真设备表)

仿真设备资产管理。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `id` | BIGINT | 设备ID |
| `device_code` | VARCHAR(100) | 设备编码 **(唯一)** |
| `device_name` | VARCHAR(200) | 设备名称 |
| `device_type` | VARCHAR(100) | 设备类型 |
| `manufacturer` | VARCHAR(200) | 生产厂商 |
| `model` | VARCHAR(100) | 型号 |
| `lab_id` | BIGINT | 所属实验室ID |
| `purchase_date` | DATE | 购置日期 |
| `purchase_price` | DECIMAL(12,2) | 购置价格 |
| `warranty_period` | INT | 质保期(月) |
| `service_life` | INT | 使用年限 |
| `maintenance_cycle` | INT | 维护周期(天) |
| `last_maintenance_date` | DATE | 最后维护日期 |
| `next_maintenance_date` | DATE | 下次维护日期 |
| `status` | TINYINT | 状态: 0-报废, 1-正常, 2-故障, 3-维修中 |
| `remark` | TEXT | 备注 |

---

#### 🔹 t_teacher_info (师资信息表)

教师扩展信息。

| 字段名 | 类型 | 说明 |
|--------|------|------|
| `id` | BIGINT | 主键 |
| `user_id` | BIGINT | 用户ID **(唯一)** |
| `title` | VARCHAR(50) | 职称 |
| `degree` | VARCHAR(50) | 学位 |
| `research_direction` | VARCHAR(500) | 研究方向 |
| `achievements` | TEXT | 教学成果 |
| `projects` | TEXT | 科研项目 |
| `publications` | TEXT | 发表论文 |
| `awards` | TEXT | 获奖情况 |
| `teaching_years` | INT | 教学年限 |
| `course_count` | INT | 授课门数 |
| `student_count` | INT | 指导学生数 |
| `rating` | DECIMAL(3,2) | 教学评分(5分制) |

---

## 🔗 ER关系图

### 核心实体关系

```
                    ┌─────────────┐
                    │   t_user    │
                    │   (用户)     │
                    └──────┬──────┘
                           │
              ┌────────────┼────────────┐
              │            │            │
         1:N  │       M:N  │       1:1  │
              ▼            ▼            ▼
    ┌─────────────┐  ┌──────────┐  ┌──────────────┐
    │ t_user_role │  │ t_course │  │t_user_profile│
    └─────────────┘  └────┬─────┘  └──────────────┘
              │           │
         M:N  │      1:N  │
              ▼           ▼
    ┌─────────────┐  ┌────────────────┐
    │   t_role    │  │t_training_task │
    └──────┬──────┘  └────────┬───────┘
           │                  │
      M:N  │             1:N  │
           ▼                  ▼
  ┌────────────────┐  ┌──────────────────┐
  │ t_permission   │  │t_training_record │
  └────────────────┘  └──────────────────┘
```

### 资源模块关系

```
┌──────────────┐
│  t_resource  │ (资源基础表)
│  (主表)      │
└──────┬───────┘
       │
       │ 1:1 (多态关联)
       │
       ├─────────► t_resource_simulation (虚拟仿真)
       ├─────────► t_resource_video      (视频)
       ├─────────► t_resource_audio      (音频)
       └─────────► t_resource_document   (文档)
```

### 实验室模块关系

```
┌──────────────┐
│t_laboratory  │
│  (实验室)    │
└──────┬───────┘
       │
       │ 1:N
       ├─────────► t_lab_reservation   (预约记录)
       ├─────────► t_lab_usage_record  (使用记录)
       └─────────► t_shared_lab        (共享配置)
```

---

## 📑 索引策略

### 唯一索引 (UNIQUE)

保证业务唯一性：

```sql
-- 用户表
uk_username (username)

-- 角色表
uk_role_code (role_code)

-- 权限表
uk_permission_code (permission_code)

-- 课程表
uk_course_code (course_code)

-- 实验室表
uk_lab_code (lab_code)

-- 复合唯一索引
uk_user_role (user_id, role_id)
uk_role_permission (role_id, permission_id)
uk_user_course (user_id, course_id)
```

### 普通索引 (KEY)

提升查询性能：

```sql
-- 外键索引
idx_user_id
idx_role_id
idx_course_id
idx_lab_id

-- 状态索引
idx_status

-- 时间索引
idx_create_time
idx_publish_time
idx_reservation_date

-- 业务字段索引
idx_student_no
idx_employee_no
idx_phone
idx_category
```

### 复合索引

多字段联合查询优化：

```sql
uk_resource_date (resource_id, monitor_date)  -- 资源监控
uk_course_date (course_id, monitor_date)      -- 教学监控
uk_task_user (task_id, user_id)              -- 过程结果
```

---

## 🔐 测试账号

| 用户名 | 密码 | 角色 | 说明 |
|-------|------|------|------|
| `admin` | `admin123` | 管理员 | 拥有所有权限 |
| `teacher` | `teacher123` | 教师 | 课程和实验管理 |
| `student` | `student123` | 学生 | 学习和实验权限 |

**密码加密算法:** BCrypt
**加密强度:** 12轮
**密码前缀:** `$2a$12$`

---

## 📊 数据流向示例

### 用户登录流程

```
1. 查询用户: SELECT * FROM t_user WHERE username = ? AND is_deleted = 0
2. 验证密码: BCrypt.checkpw(inputPassword, dbPassword)
3. 查询角色:
   SELECT r.* FROM t_role r
   JOIN t_user_role ur ON r.id = ur.role_id
   WHERE ur.user_id = ?
4. 查询权限:
   SELECT p.* FROM t_permission p
   JOIN t_role_permission rp ON p.id = rp.permission_id
   WHERE rp.role_id IN (...)
5. 生成JWT Token
6. 存储到Redis: key=login:user:{token}, value=LoginUser对象
```

### 课程报名流程

```
1. 检查课程状态: SELECT * FROM t_course WHERE id = ? AND status = 1
2. 检查是否已报名: SELECT * FROM t_user_course WHERE user_id = ? AND course_id = ?
3. 检查人数限制: enrolled_count < max_students
4. 插入报名记录: INSERT INTO t_user_course ...
5. 更新已报名人数: UPDATE t_course SET enrolled_count = enrolled_count + 1
```

### 实验室预约流程

```
1. 查询实验室: SELECT * FROM t_laboratory WHERE id = ? AND status = 1
2. 检查时间冲突:
   SELECT * FROM t_lab_reservation
   WHERE lab_id = ? AND reservation_date = ?
   AND ((start_time <= ? AND end_time > ?) OR ...)
   AND status IN (0, 1)  -- 待审核或已批准
3. 创建预约: INSERT INTO t_lab_reservation ...
4. 发送通知: INSERT INTO t_user_message ...
```

---

## 🎓 设计原则总结

本数据库设计严格遵循以下原则：

✅ **SOLID 原则**
- **单一职责:** 每张表职责明确，不混杂多种业务
- **开闭原则:** 通过扩展表（如资源详细表）支持新功能

✅ **DRY 原则**
- 统一的基础字段设计
- 复用已有表（如共享模块复用资源表和实验室表）

✅ **KISS 原则**
- 避免过度设计，采用简单直观的表结构
- 使用标准的主从表模式处理多态关系

✅ **范式化设计**
- 符合第三范式 (3NF)
- 减少数据冗余
- 保证数据一致性

✅ **扩展性设计**
- 预留扩展字段
- 支持软删除
- 支持多租户（通过 is_deleted 和用户角色隔离）

---

## 📞 技术支持

如有疑问，请参考：
- 📁 数据库脚本: `backend/database/schema.sql`
- 📝 测试数据: `backend/database/init_test_data.sql`
- 💻 实体类: `backend/src/main/java/com/training/module/*/entity/`

---

**文档维护者:** Training Team
**最后更新:** 2025-12-30
