# è™šæ‹Ÿä»¿çœŸå®è®­æ•™å­¦ç®¡ç†åŠèµ„æºå…±äº«äº‘å¹³å° - åŠŸèƒ½å®ç°æ–‡æ¡£

> **é¡¹ç›®ç‰ˆæœ¬**: v0.5
> **æŠ€æœ¯æ ˆ**: Spring Boot 3.2 + MyBatis-Plus + Vue 3 + Element Plus
> **æ–‡æ¡£æ›´æ–°**: 2026-01-04

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ¶æ„æ¦‚è¿°](#1-é¡¹ç›®æ¶æ„æ¦‚è¿°)
2. [è®¤è¯æˆæƒæ¨¡å—](#2-è®¤è¯æˆæƒæ¨¡å—)
3. [ç”¨æˆ·ç®¡ç†æ¨¡å—](#3-ç”¨æˆ·ç®¡ç†æ¨¡å—)
4. [æ–°é—»å…¬å‘Šæ¨¡å—](#4-æ–°é—»å…¬å‘Šæ¨¡å—)
5. [èµ„æºä¸­å¿ƒæ¨¡å—](#5-èµ„æºä¸­å¿ƒæ¨¡å—)
6. [ç”¨æˆ·æ”¶è—æ¨¡å—](#6-ç”¨æˆ·æ”¶è—æ¨¡å—)
7. [å‰ç«¯æ ¸å¿ƒå®ç°](#7-å‰ç«¯æ ¸å¿ƒå®ç°)
8. [æ•°æ®åº“è®¾è®¡è¯´æ˜](#8-æ•°æ®åº“è®¾è®¡è¯´æ˜)
9. [å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“](#9-å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“)

---

## 1. é¡¹ç›®æ¶æ„æ¦‚è¿°

### 1.1 æŠ€æœ¯é€‰å‹

**åç«¯æŠ€æœ¯æ ˆ**:
- **Spring Boot 3.2.1**: åº”ç”¨æ¡†æ¶ï¼Œç®€åŒ–é…ç½®å’Œå¼€å‘
- **MyBatis-Plus 3.5.5**: ORMæ¡†æ¶ï¼Œæä¾›å¼ºå¤§çš„CRUDæ“ä½œ
- **Spring Security 6**: å®‰å…¨æ¡†æ¶ï¼Œå®ç°è®¤è¯å’Œæˆæƒ
- **JWT (JJWT)**: Tokenç”Ÿæˆå’ŒéªŒè¯
- **Redis**: åˆ†å¸ƒå¼ç¼“å­˜ï¼Œå­˜å‚¨ç”¨æˆ·ä¼šè¯
- **BCrypt**: å¯†ç åŠ å¯†ç®—æ³•
- **Druid**: æ•°æ®åº“è¿æ¥æ± ï¼Œæä¾›ç›‘æ§åŠŸèƒ½

**å‰ç«¯æŠ€æœ¯æ ˆ**:
- **Vue 3.3**: æ¸è¿›å¼å‰ç«¯æ¡†æ¶
- **Vite 4**: å¿«é€Ÿæ„å»ºå·¥å…·
- **Element Plus**: UIç»„ä»¶åº“
- **Pinia**: è½»é‡çº§çŠ¶æ€ç®¡ç†
- **Vue Router 4**: è·¯ç”±ç®¡ç†
- **Axios**: HTTPå®¢æˆ·ç«¯
- **NProgress**: è¿›åº¦æ¡æ’ä»¶

### 1.2 é¡¹ç›®ç»“æ„

```
program/
â”œâ”€â”€ backend/                          # åç«¯é¡¹ç›®
â”‚   â””â”€â”€ src/main/java/com/training/
â”‚       â”œâ”€â”€ common/                   # å…¬å…±æ¨¡å—
â”‚       â”‚   â”œâ”€â”€ base/                 # åŸºç¡€ç±»ï¼ˆBaseEntityã€Resultç­‰ï¼‰
â”‚       â”‚   â”œâ”€â”€ config/               # é…ç½®ç±»
â”‚       â”‚   â”œâ”€â”€ constant/             # å¸¸é‡å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ enums/                # æšä¸¾ç±»
â”‚       â”‚   â”œâ”€â”€ exception/            # å¼‚å¸¸å¤„ç†
â”‚       â”‚   â””â”€â”€ utils/                # å·¥å…·ç±»
â”‚       â””â”€â”€ module/                   # ä¸šåŠ¡æ¨¡å—
â”‚           â”œâ”€â”€ auth/                 # è®¤è¯æ¨¡å—
â”‚           â”œâ”€â”€ user/                 # ç”¨æˆ·æ¨¡å—
â”‚           â”œâ”€â”€ news/                 # æ–°é—»æ¨¡å—
â”‚           â”œâ”€â”€ resource/             # èµ„æºæ¨¡å—
â”‚           â””â”€â”€ role/                 # è§’è‰²æ¨¡å—
â”œâ”€â”€ frontend/                         # å‰ç«¯é¡¹ç›®
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ api/                      # APIæ¥å£å°è£…
â”‚       â”œâ”€â”€ components/               # å…¬å…±ç»„ä»¶
â”‚       â”œâ”€â”€ router/                   # è·¯ç”±é…ç½®
â”‚       â”œâ”€â”€ store/                    # çŠ¶æ€ç®¡ç†
â”‚       â”œâ”€â”€ utils/                    # å·¥å…·å‡½æ•°
â”‚       â””â”€â”€ views/                    # é¡µé¢è§†å›¾
â”œâ”€â”€ database/                         # æ•°æ®åº“è„šæœ¬
â””â”€â”€ docs/                             # é¡¹ç›®æ–‡æ¡£
```

### 1.3 æ¨¡å—èŒè´£åˆ’åˆ†

| æ¨¡å— | èŒè´£ | éµå¾ªåŸåˆ™ |
|------|------|---------|
| **common** | æä¾›å…¬å…±åŸºç¡€è®¾æ–½ | DRYåŸåˆ™ï¼Œé¿å…é‡å¤ä»£ç  |
| **auth** | å¤„ç†è®¤è¯å’Œæˆæƒé€»è¾‘ | å•ä¸€èŒè´£åŸåˆ™ |
| **user** | ç”¨æˆ·CRUDå’Œèµ„æ–™ç®¡ç† | å•ä¸€èŒè´£åŸåˆ™ |
| **news** | æ–°é—»å…¬å‘Šçš„å‘å¸ƒå’Œç®¡ç† | å•ä¸€èŒè´£åŸåˆ™ |
| **resource** | å¤šç±»å‹èµ„æºç®¡ç† | å¼€é—­åŸåˆ™ï¼Œæ”¯æŒæ‰©å±• |
| **role** | è§’è‰²æƒé™ç®¡ç† | æ¥å£éš”ç¦»åŸåˆ™ |

---

## 2. è®¤è¯æˆæƒæ¨¡å—

### 2.1 æ¨¡å—åŠŸèƒ½

è®¤è¯æˆæƒæ¨¡å—æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å®‰å…¨æ ¸å¿ƒï¼Œè´Ÿè´£ï¼š
- ç”¨æˆ·ç™»å½•è®¤è¯
- JWT Tokenç”Ÿæˆå’ŒéªŒè¯
- ç”¨æˆ·ä¼šè¯ç®¡ç†
- æƒé™æ§åˆ¶

### 2.2 æŠ€æœ¯æ¶æ„

```
ç”¨æˆ·ç™»å½•
    â†“
Spring Securityè®¤è¯
    â†“
ç”ŸæˆJWT Token
    â†“
å­˜å‚¨åˆ°Redisï¼ˆä¼šè¯ç®¡ç†ï¼‰
    â†“
è¿”å›Tokenç»™å‰ç«¯
    â†“
åç»­è¯·æ±‚æºå¸¦Token
    â†“
JWTè¿‡æ»¤å™¨éªŒè¯
    â†“
è®¿é—®å—ä¿æŠ¤èµ„æº
```

### 2.3 æ ¸å¿ƒä»£ç è¯¦è§£

#### 2.3.1 AuthServiceImpl.java - è®¤è¯æœåŠ¡å®ç°

**æ–‡ä»¶ä½ç½®**: `backend/src/main/java/com/training/module/auth/service/impl/AuthServiceImpl.java`

**å…³é”®æ–¹æ³•1ï¼šç™»å½•**

```java
@Override
public LoginVO login(LoginRequest loginRequest) {
    // 1. åˆ›å»ºè®¤è¯Token
    UsernamePasswordAuthenticationToken authenticationToken =
            new UsernamePasswordAuthenticationToken(
                loginRequest.getUsername(),
                loginRequest.getPassword()
            );

    // 2. å§”æ‰˜Spring Securityè¿›è¡Œè®¤è¯
    authentication = authenticationManager.authenticate(authenticationToken);

    // 3. è·å–è®¤è¯ç”¨æˆ·ä¿¡æ¯
    LoginUser loginUser = (LoginUser) authentication.getPrincipal();

    // 4. ç”ŸæˆJWT Token
    Map<String, Object> claims = new HashMap<>();
    claims.put("userId", loginUser.getUserId());
    claims.put("username", loginUser.getUsername());
    String token = jwtUtils.generateToken(claims);

    // 5. å­˜å‚¨åˆ°Redisï¼ˆè®¾ç½®è¿‡æœŸæ—¶é—´ï¼‰
    String redisKey = CommonConstant.LOGIN_USER_KEY + token;
    redisUtils.set(redisKey, loginUser, jwtUtils.getExpiration());

    // 6. æ›´æ–°ç”¨æˆ·æœ€åç™»å½•æ—¶é—´å’ŒIP
    updateUserLoginInfo(loginUser.getUserId(), getRequestIp());

    // 7. è¿”å›ç™»å½•ä¿¡æ¯
    return new LoginVO(token, userId, username, ...);
}
```

**è®¾è®¡è¦ç‚¹**:
- **å•ä¸€èŒè´£**: æ–¹æ³•åªè´Ÿè´£ç™»å½•é€»è¾‘ï¼Œè®¤è¯å§”æ‰˜ç»™Spring Security
- **ä¾èµ–å€’ç½®**: ä¾èµ–`AuthenticationManager`æ¥å£ï¼Œè€Œéå…·ä½“å®ç°
- **å®‰å…¨æ€§**: å¯†ç åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸åšæ˜æ–‡å¤„ç†ï¼Œç”±Spring Securityå†…éƒ¨æ¯”å¯¹
- **ä¼šè¯ç®¡ç†**: ä½¿ç”¨Rediså­˜å‚¨ç™»å½•çŠ¶æ€ï¼Œæ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²

**å…³é”®æ–¹æ³•2ï¼šç™»å‡º**

```java
@Override
public void logout() {
    LoginUser loginUser = SecurityUtils.getLoginUser();
    if (loginUser != null && StrUtil.isNotBlank(loginUser.getToken())) {
        // ä»Redisåˆ é™¤ç”¨æˆ·ä¿¡æ¯
        String redisKey = CommonConstant.LOGIN_USER_KEY + loginUser.getToken();
        redisUtils.del(redisKey);
    }
}
```

**è®¾è®¡è¦ç‚¹**:
- **ä¼˜é›…å¤„ç†**: å³ä½¿åˆ é™¤å¤±è´¥ä¹Ÿä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä¿è¯ç”¨æˆ·ä½“éªŒ
- **å½»åº•æ¸…ç†**: åˆ é™¤Redisä¸­çš„ä¼šè¯ä¿¡æ¯ï¼ŒTokenç«‹å³å¤±æ•ˆ

**å…³é”®æ–¹æ³•3ï¼šTokenåˆ·æ–°**

```java
@Override
public String refreshToken() {
    LoginUser loginUser = SecurityUtils.getLoginUser();

    // 1. ç”Ÿæˆæ–°Token
    String newToken = jwtUtils.generateToken(claims);

    // 2. åˆ é™¤æ—§Token
    redisUtils.del(CommonConstant.LOGIN_USER_KEY + loginUser.getToken());

    // 3. æ›´æ–°ç”¨æˆ·ä¿¡æ¯å¹¶å­˜å‚¨æ–°Token
    loginUser.setToken(newToken);
    redisUtils.set(
        CommonConstant.LOGIN_USER_KEY + newToken,
        loginUser,
        jwtUtils.getExpiration()
    );

    return newToken;
}
```

**è®¾è®¡è¦ç‚¹**:
- **æ— ç¼åˆ‡æ¢**: æ—§Tokenåˆ é™¤åç«‹å³åˆ›å»ºæ–°Tokenï¼Œé¿å…ä¼šè¯ä¸­æ–­
- **å®‰å…¨æ€§**: Tokenåˆ·æ–°æ—¶éœ€è¦éªŒè¯å½“å‰ç”¨æˆ·èº«ä»½

#### 2.3.2 JwtUtils.java - JWTå·¥å…·ç±»

**æ–‡ä»¶ä½ç½®**: `backend/src/main/java/com/training/common/utils/JwtUtils.java`

**å…³é”®æ–¹æ³•1ï¼šç”ŸæˆToken**

```java
public String generateToken(Map<String, Object> claims) {
    Date now = new Date();
    Date expiryDate = new Date(now.getTime() + expiration * 1000);

    return Jwts.builder()
            .claims(claims)              // è‡ªå®šä¹‰å£°æ˜ï¼ˆç”¨æˆ·IDã€ç”¨æˆ·åç­‰ï¼‰
            .issuedAt(now)               // ç­¾å‘æ—¶é—´
            .expiration(expiryDate)      // è¿‡æœŸæ—¶é—´
            .signWith(getSecretKey())    // ä½¿ç”¨å¯†é’¥ç­¾å
            .compact();                  // ç”ŸæˆJWTå­—ç¬¦ä¸²
}
```

**è®¾è®¡è¦ç‚¹**:
- **çµæ´»æ€§**: æ”¯æŒè‡ªå®šä¹‰Claimsï¼Œå¯å­˜å‚¨ä»»æ„ç”¨æˆ·ä¿¡æ¯
- **å®‰å…¨æ€§**: ä½¿ç”¨HMAC-SHA256ç®—æ³•ç­¾åï¼Œé˜²æ­¢Tokenè¢«ç¯¡æ”¹
- **æ—¶æ•ˆæ€§**: è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢Tokenè¢«é•¿æœŸæ»¥ç”¨

**å…³é”®æ–¹æ³•2ï¼šéªŒè¯Token**

```java
public boolean validateToken(String token) {
    try {
        Claims claims = getClaimsFromToken(token);
        if (claims == null) {
            return false;
        }
        Date expiration = claims.getExpiration();
        return expiration != null && expiration.after(new Date());
    } catch (Exception e) {
        log.error("TokenéªŒè¯å¤±è´¥: {}", e.getMessage());
        return false;
    }
}
```

**è®¾è®¡è¦ç‚¹**:
- **å®¹é”™æ€§**: æ•è·æ‰€æœ‰å¼‚å¸¸ï¼Œè¿”å›falseè€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸
- **æ—¶æ•ˆéªŒè¯**: æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸ
- **æ—¥å¿—è®°å½•**: è®°å½•éªŒè¯å¤±è´¥çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¾¿äºæ’æŸ¥é—®é¢˜

#### 2.3.3 SecurityConfig.java - Spring Securityé…ç½®

**æ–‡ä»¶ä½ç½®**: `backend/src/main/java/com/training/common/config/SecurityConfig.java`

**æ ¸å¿ƒé…ç½®**:

```java
@Bean
public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
    http
        // 1. å…³é—­CSRFï¼ˆä½¿ç”¨JWTä¸éœ€è¦CSRFä¿æŠ¤ï¼‰
        .csrf().disable()

        // 2. æ— çŠ¶æ€ä¼šè¯ï¼ˆä¸ä½¿ç”¨Sessionï¼‰
        .sessionManagement()
            .sessionCreationPolicy(SessionCreationPolicy.STATELESS)
        .and()

        // 3. é…ç½®URLè®¿é—®æƒé™
        .authorizeHttpRequests(auth -> auth
            // ç™»å½•æ¥å£å…è®¸åŒ¿åè®¿é—®
            .requestMatchers("/v1/auth/login").anonymous()
            // Swaggeræ–‡æ¡£å…è®¸è®¿é—®
            .requestMatchers("/doc.html", "/swagger-ui/**").permitAll()
            // é™æ€èµ„æºå…è®¸è®¿é—®
            .requestMatchers("/avatars/**", "/uploads/**").permitAll()
            // å…¶ä»–è¯·æ±‚éœ€è¦è®¤è¯
            .anyRequest().authenticated()
        )

        // 4. æ·»åŠ JWTè¿‡æ»¤å™¨ï¼ˆåœ¨ç”¨æˆ·åå¯†ç è¿‡æ»¤å™¨ä¹‹å‰ï¼‰
        .addFilterBefore(jwtAuthenticationFilter, UsernamePasswordAuthenticationFilter.class);

    return http.build();
}
```

**è®¾è®¡è¦ç‚¹**:
- **æ— çŠ¶æ€è®¾è®¡**: ç¬¦åˆRESTfulè§„èŒƒï¼Œä¾¿äºæ°´å¹³æ‰©å±•
- **ç»†ç²’åº¦æ§åˆ¶**: ä¸åŒURLæœ‰ä¸åŒçš„è®¿é—®ç­–ç•¥
- **è¿‡æ»¤å™¨é“¾**: JWTè¿‡æ»¤å™¨åœ¨æ ‡å‡†è¿‡æ»¤å™¨ä¹‹å‰æ‰§è¡Œï¼Œæå‰éªŒè¯Token

**å¯†ç ç¼–ç å™¨é…ç½®**:

```java
@Bean
public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
}
```

**è®¾è®¡è¦ç‚¹**:
- **å®‰å…¨æ€§**: BCryptæ˜¯å•å‘åŠ å¯†ç®—æ³•ï¼Œæ— æ³•åå‘è§£å¯†
- **é˜²æš´åŠ›ç ´è§£**: BCryptå†…éƒ¨ä½¿ç”¨ç›å€¼å’Œå¤šè½®åŠ å¯†ï¼Œè®¡ç®—æˆæœ¬é«˜

#### 2.3.4 JwtAuthenticationFilter.java - JWTè¿‡æ»¤å™¨

**æ–‡ä»¶ä½ç½®**: `backend/src/main/java/com/training/common/config/JwtAuthenticationFilter.java`

**æ ¸å¿ƒé€»è¾‘**:

```java
@Override
protected void doFilterInternal(HttpServletRequest request,
                                 HttpServletResponse response,
                                 FilterChain filterChain) {
    // 1. ä»è¯·æ±‚å¤´è·å–Token
    String token = getTokenFromRequest(request);

    if (token != null && jwtUtils.validateToken(token)) {
        // 2. ä»Redisè·å–ç”¨æˆ·ä¿¡æ¯
        String redisKey = CommonConstant.LOGIN_USER_KEY + token;
        LoginUser loginUser = redisUtils.get(redisKey);

        if (loginUser != null) {
            // 3. åˆ›å»ºè®¤è¯å¯¹è±¡
            UsernamePasswordAuthenticationToken authentication =
                new UsernamePasswordAuthenticationToken(
                    loginUser, null, loginUser.getAuthorities()
                );

            // 4. è®¾ç½®åˆ°SecurityContext
            SecurityContextHolder.getContext().setAuthentication(authentication);
        }
    }

    // 5. ç»§ç»­è¿‡æ»¤å™¨é“¾
    filterChain.doFilter(request, response);
}
```

**è®¾è®¡è¦ç‚¹**:
- **åŒé‡éªŒè¯**: å…ˆéªŒè¯JWTçš„æœ‰æ•ˆæ€§ï¼Œå†ä»RediséªŒè¯ä¼šè¯
- **æ€§èƒ½ä¼˜åŒ–**: Redisç¼“å­˜é¿å…é¢‘ç¹æŸ¥è¯¢æ•°æ®åº“
- **å®‰å…¨æ€§**: å³ä½¿JWTæœªè¿‡æœŸï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆ é™¤Redisè®°å½•ç«‹å³å¤±æ•ˆ

### 2.4 æƒé™æ§åˆ¶

**æ–¹æ³•çº§æƒé™æ§åˆ¶**:

```java
@PreAuthorize("hasAuthority('news:create')")
public Result saveNews(...) { ... }

@PreAuthorize("hasAnyAuthority('ADMIN', 'TEACHER')")
public Result manageUsers(...) { ... }
```

**è®¾è®¡è¦ç‚¹**:
- **å£°æ˜å¼æƒé™**: ä½¿ç”¨æ³¨è§£é…ç½®ï¼Œä»£ç æ›´æ¸…æ™°
- **ç»†ç²’åº¦æ§åˆ¶**: æ”¯æŒè§’è‰²å’Œæƒé™ä¸¤ç§ç»´åº¦
- **çµæ´»ç»„åˆ**: æ”¯æŒANDã€ORç­‰é€»è¾‘è¿ç®—

---

## 3. ç”¨æˆ·ç®¡ç†æ¨¡å—

### 3.1 æ¨¡å—åŠŸèƒ½

ç”¨æˆ·ç®¡ç†æ¨¡å—æä¾›ï¼š
- ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰
- ç”¨æˆ·æ‰©å±•ä¿¡æ¯ç®¡ç†
- å¯†ç ä¿®æ”¹å’Œé‡ç½®
- å¤´åƒä¸Šä¼ 
- ç”¨æˆ·è§’è‰²åˆ†é…

### 3.2 æ•°æ®åº“è®¾è®¡

**æ ¸å¿ƒè¡¨ç»“æ„**:

**t_userï¼ˆç”¨æˆ·åŸºç¡€è¡¨ï¼‰**:
```sql
CREATE TABLE t_user (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    password VARCHAR(200) NOT NULL COMMENT 'å¯†ç ï¼ˆBCryptåŠ å¯†ï¼‰',
    real_name VARCHAR(50) COMMENT 'çœŸå®å§“å',
    student_no VARCHAR(30) COMMENT 'å­¦å·ï¼ˆå­¦ç”Ÿï¼‰',
    employee_no VARCHAR(30) COMMENT 'å·¥å·ï¼ˆæ•™å¸ˆ/ç®¡ç†å‘˜ï¼‰',
    gender TINYINT DEFAULT 0 COMMENT 'æ€§åˆ«ï¼š0-æœªçŸ¥,1-ç”·,2-å¥³',
    phone VARCHAR(20) COMMENT 'æ‰‹æœºå·',
    email VARCHAR(100) COMMENT 'é‚®ç®±',
    avatar VARCHAR(255) COMMENT 'å¤´åƒURL',
    status TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨,1-æ­£å¸¸',
    last_login_time DATETIME COMMENT 'æœ€åç™»å½•æ—¶é—´',
    last_login_ip VARCHAR(50) COMMENT 'æœ€åç™»å½•IP',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted TINYINT DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤ï¼š0-æœªåˆ é™¤,1-å·²åˆ é™¤'
);
```

**t_user_profileï¼ˆç”¨æˆ·æ‰©å±•è¡¨ï¼‰**:
```sql
CREATE TABLE t_user_profile (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT UNIQUE NOT NULL COMMENT 'ç”¨æˆ·ID',
    department VARCHAR(100) COMMENT 'é™¢ç³»',
    major VARCHAR(100) COMMENT 'ä¸“ä¸š',
    grade VARCHAR(20) COMMENT 'å¹´çº§',
    class_name VARCHAR(50) COMMENT 'ç­çº§',
    address VARCHAR(255) COMMENT 'åœ°å€',
    introduction TEXT COMMENT 'ä¸ªäººç®€ä»‹',
    ...
);
```

**è®¾è®¡åŸåˆ™**:
- **å•ä¸€èŒè´£**: åŸºç¡€ä¿¡æ¯å’Œæ‰©å±•ä¿¡æ¯åˆ†è¡¨å­˜å‚¨
- **1:1å…³ç³»**: ä¸€ä¸ªç”¨æˆ·å¯¹åº”ä¸€æ¡æ‰©å±•ä¿¡æ¯
- **é€»è¾‘åˆ é™¤**: ä½¿ç”¨`is_deleted`å­—æ®µï¼Œä¿ç•™å†å²æ•°æ®

### 3.3 æ ¸å¿ƒä»£ç è¯¦è§£

#### 3.3.1 UserController.java - ç”¨æˆ·æ§åˆ¶å™¨

**æ–‡ä»¶ä½ç½®**: `backend/src/main/java/com/training/module/user/controller/UserController.java`

**å…³é”®æ¥å£1ï¼šè·å–ç”¨æˆ·èµ„æ–™**

```java
@GetMapping("/profile")
public Result&lt;UserProfileVO&gt; getUserProfile() {
    // ä»SecurityContextè·å–å½“å‰ç™»å½•ç”¨æˆ·ID
    Long userId = SecurityUtils.getUserId();
    UserProfileVO profile = userService.getUserProfile(userId);
    return Result.success(profile);
}
```

**è®¾è®¡è¦ç‚¹**:
- **å®‰å…¨æ€§**: ä½¿ç”¨SecurityUtilsä»ä¸Šä¸‹æ–‡è·å–ç”¨æˆ·IDï¼Œè€Œéå‰ç«¯ä¼ å‚
- **ç®€æ´æ€§**: éµå¾ªKISSåŸåˆ™ï¼Œé€»è¾‘ç®€å•æ˜äº†

**å…³é”®æ¥å£2ï¼šæ›´æ–°ç”¨æˆ·èµ„æ–™**

```java
@PutMapping("/profile")
public Result&lt;Void&gt; updateProfile(@RequestBody @Valid UpdateProfileDTO dto) {
    Long userId = SecurityUtils.getUserId();
    userService.updateProfile(userId, dto);
    return Result.success();
}
```

**è®¾è®¡è¦ç‚¹**:
- **å‚æ•°éªŒè¯**: ä½¿ç”¨`@Valid`æ³¨è§£è¿›è¡Œå‚æ•°æ ¡éªŒ
- **DTOæ¨¡å¼**: ä½¿ç”¨DTOæ¥æ”¶å‰ç«¯æ•°æ®ï¼Œé¿å…ç›´æ¥ä½¿ç”¨å®ä½“ç±»

**å…³é”®æ¥å£3ï¼šä¿®æ”¹å¯†ç **

```java
@PutMapping("/password")
public Result&lt;Void&gt; changePassword(@RequestBody @Valid ChangePasswordDTO dto) {
    Long userId = SecurityUtils.getUserId();
    userService.changePassword(userId, dto.getOldPassword(), dto.getNewPassword());
    return Result.success();
}
```

**å…³é”®æ¥å£4ï¼šç®¡ç†å‘˜ç”¨æˆ·ç®¡ç†**

```java
@PreAuthorize("hasAuthority('ADMIN')")
@GetMapping("/admin/page")
public Result&lt;PageResult&lt;UserVO&gt;&gt; getUserPage(@Valid UserQueryDTO query) {
    PageResult&lt;UserVO&gt; result = userService.getUserPage(query);
    return Result.success(result);
}

@PreAuthorize("hasAuthority('ADMIN')")
@PostMapping("/admin")
public Result&lt;Long&gt; createUser(@RequestBody @Valid CreateUserDTO dto) {
    Long userId = userService.createUser(dto);
    return Result.success(userId);
}

@PreAuthorize("hasAuthority('ADMIN')")
@DeleteMapping("/admin/{userId}")
public Result&lt;Void&gt; deleteUser(@PathVariable Long userId) {
    userService.deleteUser(userId);
    return Result.success();
}
```

**è®¾è®¡è¦ç‚¹**:
- **æƒé™æ§åˆ¶**: ä½¿ç”¨`@PreAuthorize`æ³¨è§£é™åˆ¶åªæœ‰ç®¡ç†å‘˜å¯è®¿é—®
- **RESTfulé£æ ¼**: URLè®¾è®¡ç¬¦åˆRESTè§„èŒƒ
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡åˆ é™¤ç”¨æˆ·

#### 3.3.2 UserServiceImpl.java - ç”¨æˆ·æœåŠ¡å®ç°

**å…³é”®æ–¹æ³•1ï¼šåˆ›å»ºç”¨æˆ·**

```java
@Override
@Transactional(rollbackFor = Exception.class)
public Long createUser(CreateUserDTO dto) {
    // 1. æ£€æŸ¥ç”¨æˆ·åæ˜¯å¦é‡å¤
    if (userMapper.selectCount(
        new LambdaQueryWrapper&lt;User&gt;()
            .eq(User::getUsername, dto.getUsername())
    ) &gt; 0) {
        throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
    }

    // 2. åˆ›å»ºç”¨æˆ·å®ä½“
    User user = new User();
    BeanUtils.copyProperties(dto, user);

    // 3. åŠ å¯†å¯†ç 
    user.setPassword(passwordEncoder.encode(dto.getPassword()));

    // 4. ä¿å­˜ç”¨æˆ·
    userMapper.insert(user);

    // 5. ä¿å­˜ç”¨æˆ·è§’è‰²å…³è”
    if (dto.getRoleIds() != null &amp;&amp; !dto.getRoleIds().isEmpty()) {
        saveUserRoles(user.getId(), dto.getRoleIds());
    }

    return user.getId();
}
```

**è®¾è®¡è¦ç‚¹**:
- **äº‹åŠ¡ç®¡ç†**: ä½¿ç”¨`@Transactional`ä¿è¯æ•°æ®ä¸€è‡´æ€§
- **å”¯ä¸€æ€§æ£€æŸ¥**: å…ˆæ£€æŸ¥ç”¨æˆ·åæ˜¯å¦é‡å¤
- **å¯†ç å®‰å…¨**: ä½¿ç”¨BCryptåŠ å¯†å¯†ç 
- **å…³è”ä¿å­˜**: åŒæ—¶ä¿å­˜ç”¨æˆ·å’Œè§’è‰²å…³è”å…³ç³»

**å…³é”®æ–¹æ³•2ï¼šä¿®æ”¹å¯†ç **

```java
@Override
public void changePassword(Long userId, String oldPassword, String newPassword) {
    // 1. è·å–ç”¨æˆ·
    User user = userMapper.selectById(userId);

    // 2. éªŒè¯æ—§å¯†ç 
    if (!passwordEncoder.matches(oldPassword, user.getPassword())) {
        throw new BusinessException("åŸå¯†ç é”™è¯¯");
    }

    // 3. æ›´æ–°æ–°å¯†ç 
    user.setPassword(passwordEncoder.encode(newPassword));
    userMapper.updateById(user);

    // 4. æ¸…é™¤Redisä¸­çš„ç™»å½•ä¿¡æ¯ï¼ˆå¼ºåˆ¶é‡æ–°ç™»å½•ï¼‰
    clearUserSession(userId);
}
```

**è®¾è®¡è¦ç‚¹**:
- **å®‰å…¨éªŒè¯**: å¿…é¡»éªŒè¯æ—§å¯†ç æ­£ç¡®æ‰èƒ½ä¿®æ”¹
- **ä¼šè¯å¤±æ•ˆ**: ä¿®æ”¹å¯†ç åæ¸…é™¤ä¼šè¯ï¼Œé˜²æ­¢æ—§å¯†ç ç»§ç»­ä½¿ç”¨

---

## 4. æ–°é—»å…¬å‘Šæ¨¡å—

### 4.1 æ¨¡å—åŠŸèƒ½

æ–°é—»å…¬å‘Šæ¨¡å—æä¾›ï¼š
- æ–°é—»çš„åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤
- æ–°é—»çš„å‘å¸ƒã€æ’¤å›ã€ä¸‹æ¶
- æ–°é—»çš„ç½®é¡¶å’Œæ¨è
- æ–°é—»åˆ—è¡¨åˆ†é¡µæŸ¥è¯¢
- æ–°é—»è¯¦æƒ…æŸ¥çœ‹

### 4.2 æ•°æ®åº“è®¾è®¡

**t_newsï¼ˆæ–°é—»è¡¨ï¼‰**:
```sql
CREATE TABLE t_news (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    title VARCHAR(200) NOT NULL COMMENT 'æ ‡é¢˜',
    summary VARCHAR(500) COMMENT 'æ‘˜è¦',
    content TEXT COMMENT 'å†…å®¹ï¼ˆå¯Œæ–‡æœ¬ï¼‰',
    cover_image VARCHAR(255) COMMENT 'å°é¢å›¾ç‰‡',
    author VARCHAR(50) COMMENT 'ä½œè€…',
    source VARCHAR(100) COMMENT 'æ¥æº',
    category VARCHAR(50) COMMENT 'åˆ†ç±»',
    tags VARCHAR(200) COMMENT 'æ ‡ç­¾ï¼ˆé€—å·åˆ†éš”ï¼‰',
    view_count INT DEFAULT 0 COMMENT 'æµè§ˆæ¬¡æ•°',
    is_top TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦ç½®é¡¶ï¼š0-å¦,1-æ˜¯',
    is_recommend TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ¨èï¼š0-å¦,1-æ˜¯',
    publish_time DATETIME COMMENT 'å‘å¸ƒæ—¶é—´',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€ï¼š0-è‰ç¨¿,1-å·²å‘å¸ƒ,2-å·²ä¸‹æ¶',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    update_time DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    is_deleted TINYINT DEFAULT 0
);
```

### 4.3 æ ¸å¿ƒä»£ç è¯¦è§£

#### 4.3.1 NewsController.java - æ–°é—»æ§åˆ¶å™¨

**å…³é”®æ¥å£1ï¼šåˆ†é¡µæŸ¥è¯¢æ–°é—»**

```java
@GetMapping("/page")
public Result&lt;PageResult&lt;NewsVO&gt;&gt; getNewsPage(@Valid NewsQueryDTO query) {
    PageResult&lt;NewsVO&gt; result = newsService.getNewsPage(query);
    return Result.success(result);
}
```

**å…³é”®æ¥å£2ï¼šå‘å¸ƒæ–°é—»**

```java
@PreAuthorize("hasAnyAuthority('news:publish', 'ADMIN')")
@PutMapping("/{id}/publish")
public Result&lt;Void&gt; publishNews(@PathVariable Long id) {
    newsService.publishNews(id);
    return Result.success();
}
```

**å…³é”®æ¥å£3ï¼šç½®é¡¶/å–æ¶ˆç½®é¡¶**

```java
@PreAuthorize("hasAnyAuthority('news:top', 'ADMIN')")
@PutMapping("/{id}/top")
public Result&lt;Void&gt; toggleTop(@PathVariable Long id, @RequestParam Boolean isTop) {
    newsService.toggleTop(id, isTop);
    return Result.success();
}
```

#### 4.3.2 NewsServiceImpl.java - æ–°é—»æœåŠ¡å®ç°

**å…³é”®æ–¹æ³•1ï¼šåˆ†é¡µæŸ¥è¯¢**

```java
@Override
public PageResult&lt;NewsVO&gt; getNewsPage(NewsQueryDTO query) {
    // 1. æ„å»ºåˆ†é¡µå¯¹è±¡
    Page&lt;News&gt; page = new Page&lt;&gt;(query.getPageNum(), query.getPageSize());

    // 2. æ„å»ºæŸ¥è¯¢æ¡ä»¶
    LambdaQueryWrapper&lt;News&gt; wrapper = new LambdaQueryWrapper&lt;&gt;();
    wrapper.eq(News::getIsDeleted, 0)
           .eq(News::getStatus, 1)  // åªæŸ¥è¯¢å·²å‘å¸ƒçš„æ–°é—»
           .like(StringUtils.hasText(query.getTitle()), News::getTitle, query.getTitle())
           .eq(StringUtils.hasText(query.getCategory()), News::getCategory, query.getCategory())
           .orderByDesc(News::getIsTop)      // ç½®é¡¶çš„æ’åœ¨å‰é¢
           .orderByDesc(News::getPublishTime); // æŒ‰å‘å¸ƒæ—¶é—´å€’åº

    // 3. æ‰§è¡ŒæŸ¥è¯¢
    Page&lt;News&gt; newsPage = newsMapper.selectPage(page, wrapper);

    // 4. è½¬æ¢ä¸ºVO
    List&lt;NewsVO&gt; voList = newsPage.getRecords().stream()
        .map(this::convertToVO)
        .collect(Collectors.toList());

    return new PageResult&lt;&gt;(voList, newsPage.getTotal());
}
```

**è®¾è®¡è¦ç‚¹**:
- **MyBatis-Plusåˆ†é¡µ**: ä½¿ç”¨Pageå¯¹è±¡è‡ªåŠ¨åˆ†é¡µ
- **æ¡ä»¶æ„å»º**: ä½¿ç”¨LambdaQueryWrapperç±»å‹å®‰å…¨æ„å»ºæŸ¥è¯¢æ¡ä»¶
- **æ’åºç­–ç•¥**: ç½®é¡¶ä¼˜å…ˆï¼Œå†æŒ‰å‘å¸ƒæ—¶é—´å€’åº
- **VOè½¬æ¢**: å°†å®ä½“è½¬æ¢ä¸ºè§†å›¾å¯¹è±¡ï¼Œé¿å…æš´éœ²æ•æ„Ÿå­—æ®µ

**å…³é”®æ–¹æ³•2ï¼šå‘å¸ƒæ–°é—»**

```java
@Override
@Transactional(rollbackFor = Exception.class)
public void publishNews(Long id) {
    News news = newsMapper.selectById(id);
    if (news == null) {
        throw new BusinessException("æ–°é—»ä¸å­˜åœ¨");
    }

    // æ›´æ–°çŠ¶æ€ä¸ºå·²å‘å¸ƒ
    news.setStatus(1);
    news.setPublishTime(LocalDateTime.now());
    newsMapper.updateById(news);
}
```

---

## 5. èµ„æºä¸­å¿ƒæ¨¡å—

### 5.1 æ¨¡å—åŠŸèƒ½

èµ„æºä¸­å¿ƒæ¨¡å—æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œæ”¯æŒå¤šç§èµ„æºç±»å‹ï¼š
- **è™šæ‹Ÿä»¿çœŸèµ„æº**: 3Dä»¿çœŸã€VR/ARå†…å®¹
- **è§†é¢‘èµ„æº**: æ•™å­¦è§†é¢‘ã€æ¼”ç¤ºè§†é¢‘
- **éŸ³é¢‘èµ„æº**: éŸ³é¢‘è¯¾ç¨‹ã€å½•éŸ³æ–‡ä»¶
- **æ–‡æ¡£èµ„æº**: PDFã€Wordã€PPTç­‰æ–‡æ¡£

### 5.2 æ•°æ®åº“è®¾è®¡ï¼ˆç»§æ‰¿æ¨¡å¼ï¼‰

**ä¸»è¡¨ t_resource**:
```sql
CREATE TABLE t_resource (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    resource_name VARCHAR(200) NOT NULL COMMENT 'èµ„æºåç§°',
    resource_type VARCHAR(20) NOT NULL COMMENT 'èµ„æºç±»å‹ï¼šSIMULATION/VIDEO/AUDIO/DOCUMENT',
    description TEXT COMMENT 'æè¿°',
    cover_image VARCHAR(255) COMMENT 'å°é¢å›¾ç‰‡',
    category VARCHAR(50) COMMENT 'åˆ†ç±»',
    tags VARCHAR(200) COMMENT 'æ ‡ç­¾',
    uploader_id BIGINT COMMENT 'ä¸Šä¼ è€…ID',
    file_size BIGINT COMMENT 'æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰',
    download_count INT DEFAULT 0 COMMENT 'ä¸‹è½½æ¬¡æ•°',
    view_count INT DEFAULT 0 COMMENT 'æµè§ˆæ¬¡æ•°',
    is_shared TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦å…±äº«ï¼š0-ç§æœ‰,1-å…±äº«',
    status TINYINT DEFAULT 0 COMMENT 'çŠ¶æ€ï¼š0-å¾…å®¡æ ¸,1-å·²å‘å¸ƒ,2-å·²ä¸‹æ¶',
    ...
);
```

**å­è¡¨ t_resource_simulation**:
```sql
CREATE TABLE t_resource_simulation (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    resource_id BIGINT UNIQUE NOT NULL COMMENT 'èµ„æºIDï¼ˆå¤–é”®ï¼‰',
    simulation_url VARCHAR(500) COMMENT 'ä»¿çœŸæ–‡ä»¶URL',
    technology VARCHAR(50) COMMENT 'æŠ€æœ¯ç±»å‹ï¼šUnity3D/WebGL/VRç­‰',
    support_platform VARCHAR(100) COMMENT 'æ”¯æŒå¹³å°',
    min_requirement TEXT COMMENT 'æœ€ä½é…ç½®è¦æ±‚ï¼ˆJSONï¼‰',
    ...
);
```

**å…¶ä»–å­è¡¨**: `t_resource_video`ã€`t_resource_audio`ã€`t_resource_document`

### 5.3 æ ¸å¿ƒä»£ç è¯¦è§£

#### 5.3.1 ResourceController.java - èµ„æºæ§åˆ¶å™¨

**å…³é”®æ¥å£1ï¼šè·å–èµ„æºè¯¦æƒ…ï¼ˆè‡ªåŠ¨å¢åŠ æµè§ˆæ¬¡æ•°ï¼‰**

```java
@GetMapping("/{id}")
public Result&lt;ResourceDetailVO&gt; getResourceById(@PathVariable Long id) {
    // å¢åŠ æµè§ˆæ¬¡æ•°
    resourceService.incrementViewCount(id);
    // è·å–è¯¦æƒ…
    ResourceDetailVO detail = resourceService.getResourceById(id);
    return Result.success(detail);
}
```

**å…³é”®æ¥å£2ï¼šåˆ›å»ºèµ„æº**

```java
@PreAuthorize("hasAnyAuthority('resource:create', 'ADMIN')")
@PostMapping
public Result&lt;Long&gt; createResource(@RequestBody @Valid CreateResourceDTO dto) {
    Long uploaderId = SecurityUtils.getUserId();
    Long resourceId = resourceService.createResource(dto, uploaderId);
    return Result.success(resourceId);
}
```

**å…³é”®æ¥å£3ï¼šè®°å½•ä¸‹è½½**

```java
@PostMapping("/{id}/download")
public Result&lt;Void&gt; recordDownload(@PathVariable Long id) {
    resourceService.incrementDownloadCount(id);
    return Result.success();
}
```

**å…³é”®æ¥å£4ï¼šè·å–ç»Ÿè®¡ä¿¡æ¯**

```java
@GetMapping("/stats")
public Result&lt;ResourceStatsVO&gt; getResourceStats() {
    ResourceStatsVO stats = resourceService.getResourceStats();
    return Result.success(stats);
}
```

#### 5.3.2 ResourceServiceImpl.java - èµ„æºæœåŠ¡å®ç°

**å…³é”®æ–¹æ³•1ï¼šåˆ›å»ºèµ„æºï¼ˆæ”¯æŒå¤šç±»å‹ï¼‰**

```java
@Override
@Transactional(rollbackFor = Exception.class)
public Long createResource(CreateResourceDTO dto, Long uploaderId) {
    // 1. åˆ›å»ºèµ„æºåŸºç¡€ä¿¡æ¯
    Resource resource = new Resource();
    BeanUtils.copyProperties(dto, resource);
    resource.setUploaderId(uploaderId);
    resource.setStatus(0);  // å¾…å®¡æ ¸
    resourceMapper.insert(resource);

    // 2. æ ¹æ®èµ„æºç±»å‹åˆ›å»ºè¯¦æƒ…è®°å½•
    Long resourceId = resource.getId();
    switch (resource.getResourceType()) {
        case "SIMULATION":
            createSimulationDetail(resourceId, dto.getSimulationDetail());
            break;
        case "VIDEO":
            createVideoDetail(resourceId, dto.getVideoDetail());
            break;
        case "AUDIO":
            createAudioDetail(resourceId, dto.getAudioDetail());
            break;
        case "DOCUMENT":
            createDocumentDetail(resourceId, dto.getDocumentDetail());
            break;
        default:
            throw new BusinessException("ä¸æ”¯æŒçš„èµ„æºç±»å‹");
    }

    return resourceId;
}

private void createSimulationDetail(Long resourceId, SimulationDetailDTO dto) {
    ResourceSimulation simulation = new ResourceSimulation();
    simulation.setResourceId(resourceId);
    BeanUtils.copyProperties(dto, simulation);
    simulationMapper.insert(simulation);
}
```

**è®¾è®¡è¦ç‚¹**:
- **ç­–ç•¥æ¨¡å¼**: æ ¹æ®èµ„æºç±»å‹é€‰æ‹©ä¸åŒçš„å¤„ç†é€»è¾‘
- **å¼€é—­åŸåˆ™**: æ–°å¢èµ„æºç±»å‹åªéœ€æ·»åŠ caseåˆ†æ”¯ï¼Œæ— éœ€ä¿®æ”¹ä¸»æµç¨‹
- **äº‹åŠ¡ç®¡ç†**: ä¿è¯ä¸»è¡¨å’Œå­è¡¨æ•°æ®ä¸€è‡´æ€§

**å…³é”®æ–¹æ³•2ï¼šè·å–èµ„æºè¯¦æƒ…ï¼ˆå¤šè¡¨è”æŸ¥ï¼‰**

```java
@Override
public ResourceDetailVO getResourceById(Long id) {
    // 1. æŸ¥è¯¢èµ„æºåŸºç¡€ä¿¡æ¯
    Resource resource = resourceMapper.selectById(id);
    if (resource == null) {
        throw new BusinessException("èµ„æºä¸å­˜åœ¨");
    }

    // 2. è½¬æ¢ä¸ºVO
    ResourceDetailVO vo = new ResourceDetailVO();
    BeanUtils.copyProperties(resource, vo);

    // 3. æ ¹æ®ç±»å‹æŸ¥è¯¢è¯¦æƒ…
    switch (resource.getResourceType()) {
        case "SIMULATION":
            ResourceSimulation simulation = simulationMapper.selectOne(
                new LambdaQueryWrapper&lt;ResourceSimulation&gt;()
                    .eq(ResourceSimulation::getResourceId, id)
            );
            vo.setSimulationDetail(convertToSimulationVO(simulation));
            break;
        // å…¶ä»–ç±»å‹ç±»ä¼¼...
    }

    return vo;
}
```

**è®¾è®¡è¦ç‚¹**:
- **å»¶è¿ŸåŠ è½½**: å…ˆæŸ¥ä¸»è¡¨ï¼Œå†æ ¹æ®ç±»å‹æŸ¥å­è¡¨
- **VOæ¨¡å¼**: å°†å¤šè¡¨æ•°æ®ç»„è£…åˆ°ä¸€ä¸ªVOå¯¹è±¡ä¸­

---

## 6. ç”¨æˆ·æ”¶è—æ¨¡å—

### 6.1 æ¨¡å—åŠŸèƒ½

ç”¨æˆ·æ”¶è—æ¨¡å—å…è®¸ç”¨æˆ·æ”¶è—å¤šç§ç±»å‹çš„èµ„æºï¼š
- æ–°é—»èµ„è®¯
- è¯¾ç¨‹
- èµ„æºï¼ˆä»¿çœŸã€è§†é¢‘ç­‰ï¼‰
- å®éªŒå®¤
- å…¬å‘Š

### 6.2 æ•°æ®åº“è®¾è®¡

**t_user_favoriteï¼ˆç”¨æˆ·æ”¶è—è¡¨ï¼‰**:
```sql
CREATE TABLE t_user_favorite (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id BIGINT NOT NULL COMMENT 'ç”¨æˆ·ID',
    resource_type VARCHAR(20) NOT NULL COMMENT 'èµ„æºç±»å‹ï¼šNEWS/COURSE/RESOURCE/LAB/NOTICE',
    resource_id BIGINT NOT NULL COMMENT 'èµ„æºID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP,
    -- å”¯ä¸€ç´¢å¼•ï¼šåŒä¸€ç”¨æˆ·ä¸èƒ½é‡å¤æ”¶è—åŒä¸€èµ„æº
    UNIQUE KEY uk_user_resource (user_id, resource_type, resource_id)
);
```

### 6.3 æ ¸å¿ƒä»£ç è¯¦è§£

#### 6.3.1 UserFavoriteController.java - æ”¶è—æ§åˆ¶å™¨

**å…³é”®æ¥å£1ï¼šæ·»åŠ æ”¶è—**

```java
@PostMapping
public Result&lt;Long&gt; addFavorite(@RequestBody @Valid AddFavoriteDTO dto) {
    Long userId = SecurityUtils.getUserId();
    Long favoriteId = userFavoriteService.addFavorite(userId, dto);
    return Result.success(favoriteId);
}
```

**å…³é”®æ¥å£2ï¼šå–æ¶ˆæ”¶è—**

```java
@DeleteMapping("/{resourceType}/{resourceId}")
public Result&lt;Void&gt; removeFavorite(
        @PathVariable String resourceType,
        @PathVariable Long resourceId) {
    Long userId = SecurityUtils.getUserId();
    userFavoriteService.removeFavorite(userId, resourceType, resourceId);
    return Result.success();
}
```

**å…³é”®æ¥å£3ï¼šæ£€æŸ¥æ˜¯å¦å·²æ”¶è—**

```java
@GetMapping("/check/{resourceType}/{resourceId}")
public Result&lt;Boolean&gt; checkFavorite(
        @PathVariable String resourceType,
        @PathVariable Long resourceId) {
    Long userId = SecurityUtils.getUserId();
    boolean isFavorited = userFavoriteService.isFavorited(userId, resourceType, resourceId);
    return Result.success(isFavorited);
}
```

**å…³é”®æ¥å£4ï¼šè·å–æ”¶è—åˆ—è¡¨**

```java
@GetMapping
public Result&lt;PageResult&lt;FavoriteVO&gt;&gt; getFavorites(@Valid FavoriteQueryDTO query) {
    Long userId = SecurityUtils.getUserId();
    PageResult&lt;FavoriteVO&gt; result = userFavoriteService.getFavorites(userId, query);
    return Result.success(result);
}
```

#### 6.3.2 UserFavoriteServiceImpl.java - æ”¶è—æœåŠ¡å®ç°

**å…³é”®æ–¹æ³•1ï¼šæ·»åŠ æ”¶è—**

```java
@Override
public Long addFavorite(Long userId, AddFavoriteDTO dto) {
    // 1. æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
    if (isFavorited(userId, dto.getResourceType(), dto.getResourceId())) {
        throw new BusinessException("å·²æ”¶è—è¯¥èµ„æº");
    }

    // 2. éªŒè¯èµ„æºæ˜¯å¦å­˜åœ¨
    validateResourceExists(dto.getResourceType(), dto.getResourceId());

    // 3. åˆ›å»ºæ”¶è—è®°å½•
    UserFavorite favorite = new UserFavorite();
    favorite.setUserId(userId);
    favorite.setResourceType(dto.getResourceType());
    favorite.setResourceId(dto.getResourceId());
    favoriteMapper.insert(favorite);

    return favorite.getId();
}
```

**å…³é”®æ–¹æ³•2ï¼šè·å–æ”¶è—åˆ—è¡¨ï¼ˆå¤šè¡¨è”æŸ¥ï¼‰**

```java
@Override
public PageResult&lt;FavoriteVO&gt; getFavorites(Long userId, FavoriteQueryDTO query) {
    // 1. åˆ†é¡µæŸ¥è¯¢æ”¶è—è®°å½•
    Page&lt;UserFavorite&gt; page = new Page&lt;&gt;(query.getPageNum(), query.getPageSize());
    LambdaQueryWrapper&lt;UserFavorite&gt; wrapper = new LambdaQueryWrapper&lt;&gt;();
    wrapper.eq(UserFavorite::getUserId, userId)
           .eq(StringUtils.hasText(query.getResourceType()),
               UserFavorite::getResourceType, query.getResourceType())
           .orderByDesc(UserFavorite::getCreateTime);

    Page&lt;UserFavorite&gt; favoritePage = favoriteMapper.selectPage(page, wrapper);

    // 2. æŸ¥è¯¢å…³è”èµ„æºè¯¦æƒ…
    List&lt;FavoriteVO&gt; voList = favoritePage.getRecords().stream()
        .map(favorite -&gt; {
            FavoriteVO vo = new FavoriteVO();
            BeanUtils.copyProperties(favorite, vo);

            // æ ¹æ®èµ„æºç±»å‹æŸ¥è¯¢è¯¦æƒ…
            Object resourceDetail = getResourceDetail(
                favorite.getResourceType(),
                favorite.getResourceId()
            );
            vo.setResourceDetail(resourceDetail);

            return vo;
        })
        .collect(Collectors.toList());

    return new PageResult&lt;&gt;(voList, favoritePage.getTotal());
}

private Object getResourceDetail(String resourceType, Long resourceId) {
    switch (resourceType) {
        case "NEWS":
            return newsMapper.selectById(resourceId);
        case "RESOURCE":
            return resourceMapper.selectById(resourceId);
        case "COURSE":
            return courseMapper.selectById(resourceId);
        // å…¶ä»–ç±»å‹...
        default:
            return null;
    }
}
```

**è®¾è®¡è¦ç‚¹**:
- **å¤šæ€æŸ¥è¯¢**: æ ¹æ®èµ„æºç±»å‹åŠ¨æ€æŸ¥è¯¢ä¸åŒçš„è¡¨
- **æ€§èƒ½ä¼˜åŒ–**: ä½¿ç”¨Streamæ‰¹é‡å¤„ç†ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°

---

## 7. å‰ç«¯æ ¸å¿ƒå®ç°

### 7.1 çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

#### 7.1.1 ç”¨æˆ·çŠ¶æ€ç®¡ç†

**æ–‡ä»¶ä½ç½®**: `frontend/src/store/modules/user.js`

**æ ¸å¿ƒä»£ç **:

```javascript
import { defineStore } from 'pinia'
import { ref } from 'vue'
import { login, logout, getUserInfo } from '@/api/auth'
import { getToken, setToken, removeToken } from '@/utils/auth'

export const useUserStore = defineStore('user', () => {
  // çŠ¶æ€å®šä¹‰
  const token = ref(getToken())           // ä»localStorageæ¢å¤Token
  const userInfo = ref(null)
  const roles = ref([])
  const permissions = ref([])

  // ç™»å½•Action
  const loginAction = async (loginForm) => {
    const res = await login(loginForm)
    token.value = res.data.token
    setToken(res.data.token)              // æŒä¹…åŒ–åˆ°localStorage
    return res
  }

  // è·å–ç”¨æˆ·ä¿¡æ¯Action
  const getUserInfoAction = async () => {
    const res = await getUserInfo()
    userInfo.value = res.data
    roles.value = res.data.roles || []
    permissions.value = res.data.permissions || []
    return res
  }

  // ç™»å‡ºAction
  const logoutAction = async () => {
    try {
      await logout()
    } catch (error) {
      console.error('ç™»å‡ºè¯·æ±‚å¤±è´¥:', error)
    } finally {
      // æ¸…é™¤æ‰€æœ‰çŠ¶æ€
      token.value = null
      userInfo.value = null
      roles.value = []
      permissions.value = []
      removeToken()
      router.push('/login')
    }
  }

  // æƒé™åˆ¤æ–­æ–¹æ³•
  const hasRole = (role) =&gt; roles.value.includes(role)
  const hasPermission = (permission) =&gt; permissions.value.includes(permission)
  const isAdmin = () =&gt; hasRole('ADMIN')

  return {
    token, userInfo, roles, permissions,
    login: loginAction,
    getUserInfo: getUserInfoAction,
    logout: logoutAction,
    hasRole, hasPermission, isAdmin
  }
})
```

**è®¾è®¡è¦ç‚¹**:
- **ç»„åˆå¼API**: ä½¿ç”¨Vue 3çš„ç»„åˆå¼APIï¼Œä»£ç æ›´æ¸…æ™°
- **æŒä¹…åŒ–**: Tokenå­˜å‚¨åˆ°localStorageï¼Œåˆ·æ–°é¡µé¢ä¸ä¸¢å¤±
- **æƒé™åˆ¤æ–­**: æä¾›ä¾¿æ·çš„æƒé™åˆ¤æ–­æ–¹æ³•
- **é”™è¯¯å¤„ç†**: ç™»å‡ºå¤±è´¥ä¹Ÿä¼šæ¸…é™¤æœ¬åœ°çŠ¶æ€

### 7.2 è·¯ç”±å®ˆå«

**æ–‡ä»¶ä½ç½®**: `frontend/src/router/index.js`

**æ ¸å¿ƒä»£ç **:

```javascript
import NProgress from 'nprogress'
import 'nprogress/nprogress.css'

// è·¯ç”±å®ˆå«
router.beforeEach(async (to, from, next) => {
  NProgress.start()  // å¼€å§‹è¿›åº¦æ¡

  const userStore = useUserStore()
  const hasToken = userStore.token

  if (hasToken) {
    // å·²ç™»å½•
    if (to.path === '/login') {
      next({ path: '/' })  // å·²ç™»å½•åˆ™é‡å®šå‘åˆ°é¦–é¡µ
      NProgress.done()
    } else {
      // æ£€æŸ¥æ˜¯å¦å·²è·å–ç”¨æˆ·ä¿¡æ¯
      const hasUserInfo = userStore.userInfo
      if (hasUserInfo) {
        next()
      } else {
        try {
          // è·å–ç”¨æˆ·ä¿¡æ¯
          await userStore.getUserInfo()
          next()
        } catch (error) {
          // Tokenå¤±æ•ˆï¼Œæ¸…é™¤çŠ¶æ€å¹¶é‡å®šå‘åˆ°ç™»å½•é¡µ
          userStore.resetState()
          ElMessage.error('ç™»å½•çŠ¶æ€å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•')
          next({ path: '/login', query: { redirect: to.fullPath } })
          NProgress.done()
        }
      }
    }
  } else {
    // æœªç™»å½•
    if (to.meta.requireAuth !== false) {
      // éœ€è¦è®¤è¯çš„é¡µé¢ï¼Œé‡å®šå‘åˆ°ç™»å½•é¡µ
      next({ path: '/login', query: { redirect: to.fullPath } })
      NProgress.done()
    } else {
      next()
    }
  }
})

router.afterEach(() => {
  NProgress.done()  // ç»“æŸè¿›åº¦æ¡
})
```

**è®¾è®¡è¦ç‚¹**:
- **æ¸è¿›å¢å¼º**: é¦–æ¬¡è®¿é—®æ—¶è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œä¹‹åç›´æ¥ä½¿ç”¨ç¼“å­˜
- **é‡å®šå‘**: ç™»å½•åè·³è½¬å›åŸé¡µé¢
- **ç”¨æˆ·ä½“éªŒ**: ä½¿ç”¨è¿›åº¦æ¡æç¤ºåŠ è½½çŠ¶æ€

### 7.3 Axioså°è£…

**æ–‡ä»¶ä½ç½®**: `frontend/src/utils/request.js`

**æ ¸å¿ƒä»£ç **:

```javascript
import axios from 'axios'
import { ElMessage } from 'element-plus'
import { useUserStore } from '@/store/modules/user'
import { getToken } from './auth'

// åˆ›å»ºaxioså®ä¾‹
const service = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 15000
})

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(
  config =&gt; {
    const token = getToken()
    if (token) {
      // æ·»åŠ Authorizationå¤´
      config.headers['Authorization'] = 'Bearer ' + token
    }
    return config
  },
  error =&gt; {
    console.error('è¯·æ±‚é”™è¯¯:', error)
    return Promise.reject(error)
  }
)

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  response =&gt; {
    const res = response.data

    // æ ¹æ®ä¸šåŠ¡çŠ¶æ€ç å¤„ç†
    if (res.code !== 200) {
      ElMessage.error(res.message || 'è¯·æ±‚å¤±è´¥')

      // Tokenå¤±æ•ˆï¼Œè·³è½¬ç™»å½•
      if (res.code === 401) {
        const userStore = useUserStore()
        userStore.resetState()
        window.location.href = '/login'
      }

      return Promise.reject(new Error(res.message || 'è¯·æ±‚å¤±è´¥'))
    } else {
      return res
    }
  },
  error =&gt; {
    console.error('å“åº”é”™è¯¯:', error)

    // ç½‘ç»œé”™è¯¯å¤„ç†
    if (error.response) {
      const status = error.response.status
      switch (status) {
        case 401:
          ElMessage.error('æœªæˆæƒï¼Œè¯·é‡æ–°ç™»å½•')
          const userStore = useUserStore()
          userStore.resetState()
          window.location.href = '/login'
          break
        case 403:
          ElMessage.error('æ‹’ç»è®¿é—®')
          break
        case 404:
          ElMessage.error('è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨')
          break
        case 500:
          ElMessage.error('æœåŠ¡å™¨å†…éƒ¨é”™è¯¯')
          break
        default:
          ElMessage.error('è¯·æ±‚å¤±è´¥')
      }
    } else {
      ElMessage.error('ç½‘ç»œè¿æ¥å¤±è´¥')
    }

    return Promise.reject(error)
  }
)

export default service
```

**è®¾è®¡è¦ç‚¹**:
- **è‡ªåŠ¨æ³¨å…¥Token**: è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨æ·»åŠ Token
- **ç»Ÿä¸€é”™è¯¯å¤„ç†**: å“åº”æ‹¦æˆªå™¨ç»Ÿä¸€å¤„ç†é”™è¯¯
- **çŠ¶æ€ç æ˜ å°„**: å°†HTTPçŠ¶æ€ç æ˜ å°„ä¸ºç”¨æˆ·å‹å¥½çš„æç¤º
- **ä¼šè¯å¤±æ•ˆå¤„ç†**: 401é”™è¯¯è‡ªåŠ¨æ¸…é™¤çŠ¶æ€å¹¶è·³è½¬ç™»å½•

### 7.4 APIæ¥å£å°è£…

**æ–‡ä»¶ä½ç½®**: `frontend/src/api/auth.js`

```javascript
import request from '@/utils/request'

// ç™»å½•
export function login(data) {
  return request({
    url: '/v1/auth/login',
    method: 'post',
    data
  })
}

// ç™»å‡º
export function logout() {
  return request({
    url: '/v1/auth/logout',
    method: 'post'
  })
}

// è·å–ç”¨æˆ·ä¿¡æ¯
export function getUserInfo() {
  return request({
    url: '/v1/auth/user-info',
    method: 'get'
  })
}
```

**è®¾è®¡è¦ç‚¹**:
- **ç»Ÿä¸€ç®¡ç†**: æ‰€æœ‰APIæ¥å£é›†ä¸­ç®¡ç†
- **ç±»å‹å®‰å…¨**: å‡½æ•°ç­¾åæ˜ç¡®å‚æ•°ç±»å‹
- **å¤ç”¨æ€§**: ç»„ä»¶ç›´æ¥å¯¼å…¥ä½¿ç”¨

### 7.5 ç»„ä»¶ç¤ºä¾‹ï¼šç”¨æˆ·æ”¶è—é¡µé¢

**æ–‡ä»¶ä½ç½®**: `frontend/src/views/user-center/components/Favorites.vue`

**æ¨¡æ¿éƒ¨åˆ†**:

```vue
&lt;template&gt;
  &lt;div class="favorites"&gt;
    &lt;!-- ç»Ÿè®¡å¡ç‰‡ --&gt;
    &lt;el-row :gutter="20" class="stats-row"&gt;
      &lt;el-col :span="6"&gt;
        &lt;el-card class="stat-card" @click="filterType = null"&gt;
          &lt;div class="stat-content"&gt;
            &lt;div class="stat-number"&gt;{{ stats.total }}&lt;/div&gt;
            &lt;div class="stat-label"&gt;å…¨éƒ¨æ”¶è—&lt;/div&gt;
          &lt;/div&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
      &lt;!-- å…¶ä»–ç»Ÿè®¡å¡ç‰‡... --&gt;
    &lt;/el-row&gt;

    &lt;!-- æ”¶è—åˆ—è¡¨ --&gt;
    &lt;el-row :gutter="20" class="favorites-grid"&gt;
      &lt;el-col :span="6" v-for="item in favorites" :key="item.id"&gt;
        &lt;el-card class="favorite-card" :body-style="{ padding: '0px' }"&gt;
          &lt;img :src="item.resourceDetail.coverImage" class="image" /&gt;
          &lt;div class="card-content"&gt;
            &lt;div class="title"&gt;{{ item.resourceDetail.title }}&lt;/div&gt;
            &lt;div class="actions"&gt;
              &lt;el-button text @click="viewDetail(item)"&gt;æŸ¥çœ‹è¯¦æƒ…&lt;/el-button&gt;
              &lt;el-button text type="danger" @click="removeFavorite(item)"&gt;å–æ¶ˆæ”¶è—&lt;/el-button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/el-card&gt;
      &lt;/el-col&gt;
    &lt;/el-row&gt;

    &lt;!-- åˆ†é¡µ --&gt;
    &lt;el-pagination
      v-model:current-page="queryParams.pageNum"
      v-model:page-size="queryParams.pageSize"
      :total="total"
      @current-change="loadFavorites"
    /&gt;
  &lt;/div&gt;
&lt;/template&gt;
```

**è„šæœ¬éƒ¨åˆ†**:

```vue
&lt;script setup&gt;
import { ref, reactive, onMounted, watch } from 'vue'
import { getFavorites, removeFavorite as removeFavoriteApi, getFavoriteStats } from '@/api/favorite'
import { ElMessage, ElMessageBox } from 'element-plus'
import { useRouter } from 'vue-router'

const router = useRouter()

// å“åº”å¼çŠ¶æ€
const favorites = ref([])
const total = ref(0)
const stats = ref({ total: 0, resource: 0, news: 0, course: 0 })
const filterType = ref(null)

const queryParams = reactive({
  pageNum: 1,
  pageSize: 12,
  resourceType: null
})

// åŠ è½½æ”¶è—åˆ—è¡¨
const loadFavorites = async () =&gt; {
  try {
    const res = await getFavorites(queryParams)
    favorites.value = res.data.records
    total.value = res.data.total
  } catch (error) {
    ElMessage.error('åŠ è½½å¤±è´¥')
  }
}

// åŠ è½½ç»Ÿè®¡ä¿¡æ¯
const loadStats = async () =&gt; {
  try {
    const res = await getFavoriteStats()
    stats.value = res.data
  } catch (error) {
    console.error('åŠ è½½ç»Ÿè®¡å¤±è´¥:', error)
  }
}

// å–æ¶ˆæ”¶è—
const removeFavorite = async (item) =&gt; {
  try {
    await ElMessageBox.confirm('ç¡®å®šè¦å–æ¶ˆæ”¶è—å—ï¼Ÿ', 'æç¤º', {
      type: 'warning'
    })

    await removeFavoriteApi(item.resourceType, item.resourceId)
    ElMessage.success('å–æ¶ˆæ”¶è—æˆåŠŸ')
    loadFavorites()
    loadStats()
  } catch (error) {
    if (error !== 'cancel') {
      ElMessage.error('å–æ¶ˆæ”¶è—å¤±è´¥')
    }
  }
}

// æŸ¥çœ‹è¯¦æƒ…
const viewDetail = (item) =&gt; {
  const routeMap = {
    'NEWS': '/news/',
    'RESOURCE': '/resource/',
    'COURSE': '/training/'
  }
  const route = routeMap[item.resourceType]
  if (route) {
    router.push(route + item.resourceId)
  }
}

// ç›‘å¬èµ„æºç±»å‹è¿‡æ»¤
watch(filterType, (newVal) =&gt; {
  queryParams.resourceType = newVal
  queryParams.pageNum = 1
  loadFavorites()
})

// ç»„ä»¶æŒ‚è½½æ—¶åŠ è½½æ•°æ®
onMounted(() =&gt; {
  loadFavorites()
  loadStats()
})
&lt;/script&gt;
```

**è®¾è®¡è¦ç‚¹**:
- **ç»„åˆå¼API**: ä½¿ç”¨Vue 3çš„ç»„åˆå¼APIï¼Œé€»è¾‘æ›´æ¸…æ™°
- **å“åº”å¼æ•°æ®**: ä½¿ç”¨refå’Œreactiveå®šä¹‰å“åº”å¼çŠ¶æ€
- **ç”Ÿå‘½å‘¨æœŸ**: onMountedé’©å­åŠ è½½åˆå§‹æ•°æ®
- **ç”¨æˆ·äº¤äº’**: äºŒæ¬¡ç¡®è®¤åˆ é™¤æ“ä½œï¼Œé¿å…è¯¯æ“ä½œ
- **è·¯ç”±è·³è½¬**: æ ¹æ®èµ„æºç±»å‹è·³è½¬åˆ°ä¸åŒçš„è¯¦æƒ…é¡µé¢

---

## 8. æ•°æ®åº“è®¾è®¡è¯´æ˜

### 8.1 è®¾è®¡åŸåˆ™

æœ¬é¡¹ç›®æ•°æ®åº“è®¾è®¡éµå¾ªä»¥ä¸‹åŸåˆ™ï¼š

1. **è§„èŒƒåŒ–è®¾è®¡**: ç¬¦åˆç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ï¼Œå‡å°‘æ•°æ®å†—ä½™
2. **é€»è¾‘åˆ é™¤**: æ‰€æœ‰è¡¨ä½¿ç”¨`is_deleted`å­—æ®µï¼Œä¿ç•™å†å²æ•°æ®
3. **æ—¶é—´è¿½è¸ª**: ç»Ÿä¸€ä½¿ç”¨`create_time`å’Œ`update_time`å­—æ®µ
4. **å”¯ä¸€çº¦æŸ**: å…³é”®å­—æ®µæ·»åŠ å”¯ä¸€ç´¢å¼•ï¼Œé˜²æ­¢é‡å¤æ•°æ®
5. **å¤–é”®å…³è”**: ä½¿ç”¨é€»è¾‘å¤–é”®ï¼ˆä¸ä½¿ç”¨ç‰©ç†å¤–é”®ï¼‰ï¼Œä¿è¯çµæ´»æ€§

### 8.2 è¡¨å…³ç³»å›¾

```
ç”¨æˆ·æƒé™ä½“ç³»:
    t_user â”€â”€1:Nâ”€â”€ t_user_role â”€â”€N:1â”€â”€ t_role â”€â”€1:Nâ”€â”€ t_role_permission â”€â”€N:1â”€â”€ t_permission
       â”‚
       â””â”€â”€1:1â”€â”€ t_user_profile

å†…å®¹ç®¡ç†:
    t_user â”€â”€1:Nâ”€â”€ t_news
    t_user â”€â”€1:Nâ”€â”€ t_resource â”€â”€1:1â”€â”€ t_resource_simulation/video/audio/document

ç”¨æˆ·æ”¶è—:
    t_user â”€â”€1:Nâ”€â”€ t_user_favorite
```

### 8.3 ç´¢å¼•è®¾è®¡

**å…³é”®ç´¢å¼•**:

```sql
-- ç”¨æˆ·è¡¨
CREATE UNIQUE INDEX uk_username ON t_user(username);
CREATE INDEX idx_status ON t_user(status);
CREATE INDEX idx_deleted ON t_user(is_deleted);

-- æ–°é—»è¡¨
CREATE INDEX idx_status_deleted ON t_news(status, is_deleted);
CREATE INDEX idx_category ON t_news(category);
CREATE INDEX idx_publish_time ON t_news(publish_time);

-- èµ„æºè¡¨
CREATE INDEX idx_type_status ON t_resource(resource_type, status);
CREATE INDEX idx_uploader ON t_resource(uploader_id);

-- æ”¶è—è¡¨
CREATE UNIQUE INDEX uk_user_resource ON t_user_favorite(user_id, resource_type, resource_id);
CREATE INDEX idx_user_id ON t_user_favorite(user_id);
```

**ç´¢å¼•è®¾è®¡åŸåˆ™**:
- é«˜é¢‘æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- å¤–é”®å­—æ®µæ·»åŠ ç´¢å¼•
- ç»„åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™
- é¿å…è¿‡å¤šç´¢å¼•å½±å“å†™å…¥æ€§èƒ½

---

## 9. å…³é”®æŠ€æœ¯ç‚¹æ€»ç»“

### 9.1 Spring Bootæ ¸å¿ƒç‰¹æ€§

**1. è‡ªåŠ¨é…ç½®**:
- Spring Securityè‡ªåŠ¨é…ç½®è®¤è¯æµç¨‹
- MyBatis-Plusè‡ªåŠ¨é…ç½®åˆ†é¡µæ’ä»¶

**2. æ¡ä»¶æ³¨è§£**:
```java
@ConditionalOnProperty(name = "training.jwt.enabled", havingValue = "true")
public class JwtConfig { ... }
```

**3. é…ç½®ç»‘å®š**:
```java
@ConfigurationProperties(prefix = "training.jwt")
public class JwtProperties { ... }
```

### 9.2 MyBatis-Pluså¼ºå¤§åŠŸèƒ½

**1. è‡ªåŠ¨å¡«å……**:
```java
@TableField(fill = FieldFill.INSERT)
private LocalDateTime createTime;

@TableField(fill = FieldFill.INSERT_UPDATE)
private LocalDateTime updateTime;
```

**2. é€»è¾‘åˆ é™¤**:
```java
@TableLogic
private Integer isDeleted;
```

**3. LambdaQueryWrapperç±»å‹å®‰å…¨**:
```java
LambdaQueryWrapper&lt;User&gt; wrapper = new LambdaQueryWrapper&lt;&gt;();
wrapper.eq(User::getUsername, username)
       .eq(User::getIsDeleted, 0);
```

### 9.3 Spring Securityæ ¸å¿ƒæœºåˆ¶

**1. è®¤è¯æµç¨‹**:
```
UsernamePasswordAuthenticationToken
    â†’ AuthenticationManager
    â†’ DaoAuthenticationProvider
    â†’ UserDetailsService.loadUserByUsername()
    â†’ PasswordEncoder.matches()
    â†’ Authenticationå¯¹è±¡
```

**2. æˆæƒæµç¨‹**:
```
@PreAuthorizeæ³¨è§£
    â†’ MethodSecurityInterceptor
    â†’ AccessDecisionManager
    â†’ æ£€æŸ¥ç”¨æˆ·æƒé™
    â†’ å…è®¸/æ‹’ç»è®¿é—®
```

### 9.4 å‰ç«¯æ ¸å¿ƒæŠ€æœ¯

**1. Vue 3ç»„åˆå¼APIä¼˜åŠ¿**:
- æ›´å¥½çš„ç±»å‹æ¨å¯¼
- é€»è¾‘å¤ç”¨æ›´ç®€å•
- æ›´çµæ´»çš„ä»£ç ç»„ç»‡

**2. PiniaçŠ¶æ€ç®¡ç†**:
- æ›´è½»é‡çº§ï¼ˆç›¸æ¯”Vuexï¼‰
- å®Œæ•´çš„TypeScriptæ”¯æŒ
- è‡ªåŠ¨ä»£ç åˆ†å‰²

**3. Viteæ„å»ºå·¥å…·**:
- æé€Ÿçš„å†·å¯åŠ¨
- å³æ—¶çš„æ¨¡å—çƒ­æ›´æ–°
- ä¼˜åŒ–çš„ç”Ÿäº§æ„å»º

### 9.5 æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

**åç«¯ä¼˜åŒ–**:
1. **Redisç¼“å­˜**: ç”¨æˆ·ä¼šè¯ã€çƒ­ç‚¹æ•°æ®ç¼“å­˜
2. **æ•°æ®åº“ç´¢å¼•**: è¦†ç›–é«˜é¢‘æŸ¥è¯¢å­—æ®µ
3. **åˆ†é¡µæŸ¥è¯¢**: é¿å…ä¸€æ¬¡åŠ è½½å¤§é‡æ•°æ®
4. **æ‡’åŠ è½½**: å…³è”æ•°æ®æŒ‰éœ€æŸ¥è¯¢

**å‰ç«¯ä¼˜åŒ–**:
1. **è·¯ç”±æ‡’åŠ è½½**: æŒ‰éœ€åŠ è½½é¡µé¢ç»„ä»¶
2. **ç»„ä»¶æ‡’åŠ è½½**: ä½¿ç”¨defineAsyncComponent
3. **å›¾ç‰‡æ‡’åŠ è½½**: ä½¿ç”¨v-lazyæŒ‡ä»¤
4. **é˜²æŠ–èŠ‚æµ**: æœç´¢æ¡†ã€æ»šåŠ¨äº‹ä»¶ä½¿ç”¨é˜²æŠ–

### 9.6 å®‰å…¨æªæ–½

**1. å¯†ç å®‰å…¨**:
- BCryptåŠ å¯†ï¼Œ12è½®å“ˆå¸Œ
- ç™»å½•å¤±è´¥æ¬¡æ•°é™åˆ¶ï¼ˆå¯æ‰©å±•ï¼‰
- å¯†ç å¼ºåº¦è¦æ±‚ï¼ˆå‰ç«¯éªŒè¯ï¼‰

**2. Tokenå®‰å…¨**:
- JWTç­¾åé˜²ç¯¡æ”¹
- Tokenè¿‡æœŸæ—¶é—´è®¾ç½®
- Tokenåˆ·æ–°æœºåˆ¶
- Rediså­˜å‚¨æ”¯æŒç«‹å³å¤±æ•ˆ

**3. æ¥å£å®‰å…¨**:
- CORSè·¨åŸŸé™åˆ¶
- è¯·æ±‚å‚æ•°éªŒè¯ï¼ˆ@Validï¼‰
- SQLæ³¨å…¥é˜²æŠ¤ï¼ˆMyBatisé¢„ç¼–è¯‘ï¼‰
- XSSé˜²æŠ¤ï¼ˆå‰ç«¯è½¬ä¹‰ï¼‰

### 9.7 ä»£ç è´¨é‡ä¿è¯

**1. éµå¾ªè®¾è®¡åŸåˆ™**:
- **SOLID**: æ¯ä¸ªç±»èŒè´£å•ä¸€ï¼Œä¾èµ–æ¥å£è€Œéå®ç°
- **DRY**: å…¬å…±ä»£ç æå–åˆ°baseåŒ…
- **KISS**: ä»£ç é€»è¾‘ç®€å•æ˜äº†
- **YAGNI**: ä¸åšè¿‡åº¦è®¾è®¡

**2. å¼‚å¸¸å¤„ç†**:
```java
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(BusinessException.class)
    public Result handleBusinessException(BusinessException e) {
        return Result.error(e.getMessage());
    }
}
```

**3. æ—¥å¿—è®°å½•**:
```java
@Slf4j
public class AuthServiceImpl {
    public void login() {
        log.info("ç”¨æˆ·{}ç™»å½•æˆåŠŸ", username);
        log.error("ç™»å½•å¤±è´¥: {}", e.getMessage());
    }
}
```

---

## ğŸ“Œ æ€»ç»“

æœ¬ç³»ç»Ÿæ˜¯ä¸€ä¸ª**åŠŸèƒ½å®Œæ•´ã€æ¶æ„æ¸…æ™°ã€ä»£ç è§„èŒƒ**çš„è™šæ‹Ÿä»¿çœŸå®è®­æ•™å­¦ç®¡ç†åŠèµ„æºå…±äº«äº‘å¹³å°ã€‚ä¸»è¦ç‰¹ç‚¹ï¼š

### âœ… å®Œæˆçš„æ ¸å¿ƒåŠŸèƒ½
1. **è®¤è¯æˆæƒç³»ç»Ÿ** - JWT + Spring Security + Redisä¼šè¯ç®¡ç†
2. **ç”¨æˆ·ç®¡ç†ç³»ç»Ÿ** - å®Œæ•´çš„ç”¨æˆ·CRUDå’Œæƒé™æ§åˆ¶
3. **æ–°é—»å…¬å‘Šç®¡ç†** - å‘å¸ƒã€ç½®é¡¶ã€æ¨èç­‰åŠŸèƒ½
4. **èµ„æºä¸­å¿ƒ** - æ”¯æŒ4ç§èµ„æºç±»å‹çš„ç»Ÿä¸€ç®¡ç†
5. **ç”¨æˆ·æ”¶è—** - å¤šèµ„æºç±»å‹æ”¶è—åŠŸèƒ½
6. **ç®¡ç†åå°** - ç”¨æˆ·ã€æ–°é—»ã€ç³»ç»Ÿè®¾ç½®ç®¡ç†

### ğŸ¯ æŠ€æœ¯äº®ç‚¹
- å‰åç«¯å®Œå…¨åˆ†ç¦»ï¼ŒRESTful APIè®¾è®¡
- Spring Security + JWTæ— çŠ¶æ€è®¤è¯
- MyBatis-Pluså¼ºå¤§çš„ORMèƒ½åŠ›
- Vue 3ç»„åˆå¼API + PiniaçŠ¶æ€ç®¡ç†
- Redisç¼“å­˜æå‡æ€§èƒ½
- å®Œå–„çš„æƒé™æ§åˆ¶ä½“ç³»
- è§„èŒƒçš„ä»£ç ç»“æ„å’Œå‘½å

### ğŸš€ æ‰©å±•æ€§
- æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ·»åŠ æ–°åŠŸèƒ½
- èµ„æºç±»å‹æ”¯æŒæ‰©å±•ï¼ˆå¼€é—­åŸåˆ™ï¼‰
- æƒé™ç³»ç»Ÿçµæ´»é…ç½®
- æ•°æ®åº“é¢„ç•™æ‰©å±•è¡¨

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-04
**ç»´æŠ¤å›¢é˜Ÿ**: Training Team
